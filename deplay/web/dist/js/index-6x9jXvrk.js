import{l as n,r as o,j as t,hh as O,h2 as w,h3 as r,h8 as z,S as d,V as j,hg as B,Y as m,hp as A,hx as K,hy as b,hb as L,gU as V,Z as x,ha as Y}from"./vendor-core-BL9Phd6R.js";import{A as h}from"./route-login-p179xrQD.js";import"./route-layout-De7MC9tK.js";const T={0:"未知异常",1:"工装车厂房不匹配",2:"牵引车厂房不匹配"},S={0:"未处理",1:"已处理"},$=a=>h.post({url:"/asset/exception/flow/list",data:a}),_=a=>h.post({url:"/asset/exception/handle",data:a}),q=a=>h.post({url:"/asset/exception/batchHandle",data:a}),J=a=>h.post({url:"/asset/exception/export",data:a}),{RangePicker:Q}=z,W=()=>{const[a]=n.useForm(),[D,H]=o.useState([]),[g,y]=o.useState(!1),[M,R]=o.useState(0),[u,C]=o.useState(1),[c,E]=o.useState(10),[p,f]=o.useState([]),[F,I]=o.useState(!1),i=async()=>{y(!0);try{const e=a.getFieldsValue(),s={limit:c,offset:(u-1)*c,startTime:e.timeRange?.[0]?.format("YYYY-MM-DD HH:mm:ss"),endTime:e.timeRange?.[1]?.format("YYYY-MM-DD HH:mm:ss"),exceptionType:e.exceptionType,status:e.status,assetId:e.assetId},l=await $(s);l.code===200&&(H(l.data.list),R(l.data.total))}catch{x.error("查询失败")}finally{y(!1)}};o.useEffect(()=>{i()},[u,c]);const N=e=>{Y.confirm({title:"处理异常",content:t.jsx(n,{layout:"vertical",id:"handleForm",children:t.jsx(n.Item,{name:"handleNote",label:"处理备注",children:t.jsx(j.TextArea,{})})}),onOk:async()=>{const s=document.getElementById("handleForm")?.handleNote?.value||"";await _({id:e.id.toString(),status:1,handleNote:s}),x.success("处理成功"),i()}})},k=()=>{Y.confirm({title:"批量处理异常",content:t.jsx(n,{layout:"vertical",id:"batchHandleForm",children:t.jsx(n.Item,{name:"handleNote",label:"处理备注",children:t.jsx(j.TextArea,{})})}),onOk:async()=>{const e=document.getElementById("batchHandleForm")?.handleNote?.value||"";await q({ids:p,status:1,handleNote:e}),x.success("批量处理成功"),f([]),i()}})},v=async()=>{I(!0);try{const e=a.getFieldsValue(),s={limit:1e4,offset:0,startTime:e.timeRange?.[0]?.format("YYYY-MM-DD HH:mm:ss"),endTime:e.timeRange?.[1]?.format("YYYY-MM-DD HH:mm:ss"),exceptionType:e.exceptionType,status:e.status,assetId:e.assetId},l=await J(s);l.code===200&&l.data&&window.open(l.data,"_blank")}catch{x.error("导出失败")}finally{I(!1)}},P=[{title:"异常类型",dataIndex:"exceptionType",render:e=>T[e]},{title:"资产ID",dataIndex:"assetId"},{title:"检测时间",dataIndex:"detectionTime",render:e=>e?V(e).format("YYYY-MM-DD HH:mm:ss"):"-"},{title:"状态",dataIndex:"status",render:e=>S[e]},{title:"异常内容",dataIndex:"exceptionNote",render:e=>e||"-"},{title:"备注",dataIndex:"remark",render:e=>e||"-"},{title:"操作",dataIndex:"action",render:(e,s)=>s.status===0?t.jsx(m,{type:"link",icon:t.jsx(b,{}),onClick:()=>N(s),children:"处理"}):t.jsx("span",{style:{color:"#aaa"},children:"已处理"})}];return t.jsx("div",{className:"p-6",children:t.jsxs(O,{children:[t.jsxs(n,{form:a,layout:"vertical",onFinish:i,children:[t.jsxs(w,{gutter:[16,16],children:[t.jsx(r,{xs:24,sm:12,md:8,lg:6,children:t.jsx(n.Item,{name:"timeRange",label:"时间范围",children:t.jsx(Q,{showTime:!0,style:{width:"100%"}})})}),t.jsx(r,{xs:24,sm:12,md:8,lg:6,children:t.jsx(n.Item,{name:"exceptionType",label:"异常类型",children:t.jsx(d,{allowClear:!0,placeholder:"请选择异常类型",children:Object.entries(T).map(([e,s])=>t.jsx(d.Option,{value:Number(e),children:s},e))})})}),t.jsx(r,{xs:24,sm:12,md:8,lg:6,children:t.jsx(n.Item,{name:"status",label:"处理状态",children:t.jsx(d,{allowClear:!0,placeholder:"请选择处理状态",children:Object.entries(S).map(([e,s])=>t.jsx(d.Option,{value:Number(e),children:s},e))})})}),t.jsx(r,{xs:24,sm:12,md:8,lg:6,children:t.jsx(n.Item,{name:"assetId",label:"资产ID",children:t.jsx(j,{allowClear:!0,placeholder:"请输入资产ID"})})})]}),t.jsx(w,{children:t.jsx(r,{span:24,children:t.jsx(n.Item,{children:t.jsxs(B,{size:"middle",children:[t.jsx(m,{type:"primary",htmlType:"submit",icon:t.jsx(A,{}),loading:g,children:"查询"}),t.jsx(m,{icon:t.jsx(K,{}),onClick:v,loading:F,children:"导出"}),t.jsx(m,{type:"default",disabled:p.length===0,onClick:k,icon:t.jsx(b,{}),children:"批量处理"})]})})})})]}),t.jsx(L,{className:"mt-6",columns:P,dataSource:D,rowKey:"id",loading:g,rowSelection:{selectedRowKeys:p,onChange:f,getCheckboxProps:e=>({disabled:e.status===1})},pagination:{current:u,pageSize:c,total:M,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`,onChange:(e,s)=>{C(e),E(s||10)}}})]})})};export{W as default};
