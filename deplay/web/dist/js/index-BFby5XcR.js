import{r as a,j as o}from"./vendor-react-BvY5jkjb.js";import{A as c}from"./route-login-BWcqE1fc.js";import{s as U,u as W,V as Y,X as j,O as A,S}from"./vendor-antd-VwCNQJi5.js";import"./vendor-common-DvYBgWFG.js";import"./route-layout-33ldzD5l.js";import"./vendor-redux-D__shqzO.js";import"./vendor-router-C3iwmVt3.js";const Z=()=>c.get({url:"/monitor/store/list"}),G=r=>c.post({url:"/monitor/group/list",data:r}),ee=r=>c.post({url:"/monitor/asset/list",data:r}),te=r=>c.post({url:"/monitor/ag/update",data:r}),se=r=>c.post({url:"/monitor/gs/update",data:r}),{Option:g}=S,de=()=>{const[r,z]=U.useMessage(),[h,T]=a.useState("1"),[v,P]=a.useState([]),[k,b]=a.useState(0),[u,D]=a.useState(1),[i,E]=a.useState(10),[N,K]=a.useState([]),[m,f]=a.useState([]),[L,y]=a.useState(0),[d,R]=a.useState(1),[l,B]=a.useState(10),[re,I]=a.useState(!1),[J,p]=a.useState(!1),[M,x]=a.useState(!1);a.useEffect(()=>{(async()=>{I(!0),p(!0);try{const s=await Z();K(s.data);const n=await G({limit:l,offset:0});f(n.data.list),y(n.data.total)}catch(s){console.error("初始化数据失败:",s),r.error("初始化数据失败")}finally{I(!1),p(!1)}})()},[]);const w=async(e,s)=>{x(!0);try{const t={limit:s,offset:(e-1)*s},n=await ee(t);P(n.data.list),b(n.data.total)}catch(t){console.error("获取资产列表失败:",t),r.error("获取资产列表失败")}finally{x(!1)}},C=async(e,s)=>{p(!0);try{const t={limit:s,offset:(e-1)*s},n=await G(t);f(n.data.list),y(n.data.total)}catch(t){console.error("获取班组列表失败:",t),r.error("获取班组列表失败")}finally{p(!1)}};a.useEffect(()=>{h==="1"?w(u,i):C(d,l)},[h,u,i,d,l]);const O=e=>{e.current&&e.pageSize&&(D(e.current),E(e.pageSize))},Q=e=>{e.current&&e.pageSize&&(R(e.current),B(e.pageSize))},V=async(e,s)=>{try{await te({assetId:e,groupId:s||0}),r.success("更新成功"),w(u,i)}catch(t){console.error("更新失败:",t),r.error("更新失败")}},_=async(e,s)=>{try{await se({groupId:e,storeId:s}),r.success("更新成功"),C(d,l)}catch(t){console.error("更新失败:",t),r.error("更新失败")}},$=[{title:"资产ID",dataIndex:"assetId",key:"assetId"},{title:"资产编码",dataIndex:"assetCode",key:"assetCode"},{title:"所属班组",key:"groupId",render:(e,s)=>o.jsxs(S,{value:s.groupId,onChange:t=>V(s.assetId,t),style:{width:200},placeholder:"请选择班组",children:[o.jsx(g,{value:null,children:"未分配"}),m.map(t=>o.jsx(g,{value:t.groupId,children:t.groupName},t.groupId))]})}],q=[{title:"班组ID",dataIndex:"groupId",key:"groupId"},{title:"班组名称",dataIndex:"groupName",key:"groupName"},{title:"所属场库",key:"storeId",render:(e,s)=>o.jsxs(S,{value:s.storeId||0,onChange:t=>_(s.groupId,t),style:{width:200},placeholder:"请选择场库",children:[o.jsx(g,{value:0,children:"未分配"}),N.map(t=>o.jsx(g,{value:t.StoreId,children:t.StoreName},t.StoreId))]})}],F=()=>o.jsx(j,{direction:"vertical",size:"large",style:{width:"100%"},children:o.jsx(A,{columns:$,dataSource:v,rowKey:"assetId",loading:M,pagination:{current:u,pageSize:i,total:k,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条`},onChange:O})}),H=()=>o.jsx(j,{direction:"vertical",size:"large",style:{width:"100%"},children:o.jsx(A,{columns:q,dataSource:m,rowKey:"groupId",loading:J,pagination:{current:d,pageSize:l,total:L,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条`},onChange:Q})}),X=[{key:"1",label:"资产-班组绑定",children:o.jsx(F,{})},{key:"2",label:"班组-场库绑定",children:o.jsx(H,{})}];return o.jsxs(W,{children:[z,o.jsx(Y,{activeKey:h,onChange:T,items:X})]})};export{de as default};
