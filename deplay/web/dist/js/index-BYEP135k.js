import{h6 as V,r as n,j as t,V as k,S as f,gU as R,ha as N,hb as _,hc as K,l as i}from"./vendor-core-BL9Phd6R.js";import{A as c}from"./route-login-r9SQJoz-.js";import{u as $}from"./useSearchForm-DGLxIQDe.js";import"./route-layout-BrOgEPTf.js";const B=s=>c.post({url:"/asset/query",data:s}),G=s=>c.post({url:"/asset",data:s}),J=(s,o)=>c.patch({url:`/asset/update/${s}`,data:o}),Q=s=>c.delete({url:"/asset/batch-delete",data:s}),T={1:"工装车",2:"牵引车"},Y={1:"正常在库",2:"正常出库",3:"异常待修",4:"维修中",5:"报废",6:"呆滞",7:"疑似丢失"},W=()=>c.get({url:"/sl/store/map"}),X=()=>c.get({url:"/iot/tag/map"}),Z=()=>{const[s]=V(),[o,I]=n.useState(10),[g,j]=n.useState(1),[y,S]=n.useState(0),[A,h]=n.useState(!1),[E,C]=n.useState([]),[b,q]=n.useState([]),[d,F]=n.useState(),[u,x]=n.useState(!1),[m,a]=n.useState(!1),[l,w]=n.useState([]),[O,D]=n.useState([]);n.useEffect(()=>{W().then(e=>{w(e.data)})},[]),n.useEffect(()=>{X().then(e=>{D(e.data)})},[]);const P=[{label:"资产编码",name:"assetCode",component:t.jsx(k,{placeholder:"请输入资产编码",allowClear:!0})},{label:"场库",name:"storeId",component:t.jsx(f,{placeholder:"请选择场库",allowClear:!0,children:l.map(e=>t.jsx(f.Option,{value:e.storeId,children:e.storeName},e.storeId))})}],{SearchFormComponent:H}=$({getDataRequestFn:e=>p(e),onNewRecordFn:()=>{x(!1),s.resetFields(),a(!0)},formItems:P,formName:"roleSearchUserForm"}),p=e=>{h(!0),B({limit:o,offset:(g-1)*o,...e}).then(r=>{q(r.data.list),S(r.data.total)}).finally(()=>{h(!1)})},v=e=>{N.confirm({title:"确认删除",content:"确定要删除该资产吗？",okText:"确定",cancelText:"取消",onOk:()=>{Q([e]).then(()=>p())}})},z=async e=>{F(e),x(!0),a(!0)},L=()=>{s.validateFields().then(e=>{const r={...e,quantity:Number(e.quantity),tagId:Number(e.tagId)};u&&d?J(d.assetId,{...d,...r}).then(()=>{a(!1),s.resetFields(),p()}):G(r).then(()=>{a(!1),s.resetFields(),p()})})},U=[{title:"资产ID",dataIndex:"assetId",key:"assetId"},{title:"资产编码",dataIndex:"assetCode",key:"assetCode"},{title:"资产类型",dataIndex:"assetType",key:"assetType",render:e=>T[e]||"-"},{title:"资产状态",dataIndex:"status",key:"status",render:e=>Y[e]||"-"},{title:"数量",dataIndex:"quantity",key:"quantity"},{title:"标签编码",dataIndex:"tagId",key:"tagCode",render:e=>O.find(M=>Number(M.id)===e)?.tagCode||"未设置"},{title:"场库名称",dataIndex:"storeId",key:"storeName",render:e=>l.find(M=>M.storeId===e)?.storeName||"未设置"},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",render:e=>R(e).format("YYYY-MM-DD HH:mm:ss")},{title:"更新时间",dataIndex:"updatedAt",key:"updatedAt",render:e=>R(e).format("YYYY-MM-DD HH:mm:ss")},{title:"操作",key:"action",align:"center",render:(e,r)=>t.jsxs("div",{className:"gap-2 flex text-[#5bb4ef] items-center cursor-pointer justify-center",children:[t.jsx("span",{onClick:()=>z(r),children:"编辑"}),t.jsx("span",{className:"text-red-500",onClick:()=>v(r.assetId),children:"删除"})]})}];return n.useEffect(()=>{m&&u&&s.setFieldsValue(d)},[m]),n.useEffect(()=>{p()},[o,g]),{list:b,roleColumns:U,SearchFormComponent:H,total:y,limit:o,loading:A,isEdit:u,formRef:s,editAssetModalOpen:m,setPage:j,setLimit:I,setSelected:C,setEditAssetModalOpen:e=>{a(e),e||s.resetFields()},onFinish:L,tagMap:O}},ee=()=>{const{list:s,roleColumns:o,SearchFormComponent:I,total:g,limit:j,loading:y,isEdit:S,formRef:A,editAssetModalOpen:h,setPage:E,setLimit:C,setSelected:b,setEditAssetModalOpen:q,onFinish:d,tagMap:F}=Z(),u=Object.entries(T).map(([a,l])=>({label:l,value:parseInt(a,10)})),x=Object.entries(Y).map(([a,l])=>({label:l,value:parseInt(a,10)})),m=F.map(a=>({label:a.tagCode,value:a.id}));return t.jsxs(t.Fragment,{children:[I,t.jsx(_,{dataSource:s,rowSelection:{onChange:a=>{b(a)}},loading:y,columns:o,bordered:!0,pagination:!1,rowKey:"assetId"}),t.jsx(K,{total:g,className:"flex justify-end mt-2",pageSize:j,onChange:a=>E(a),showSizeChanger:!0,onShowSizeChange:(a,l)=>C(l)}),t.jsx(N,{open:h,title:S?"编辑":"新增",onOk:d,onCancel:()=>q(!1),children:t.jsxs(i,{form:A,autoComplete:"off",labelAlign:"left",id:"editFormRef",children:[t.jsx(i.Item,{name:"assetCode",label:"资产编码",rules:[{required:!0,message:"请输入资产编码"}],children:t.jsx(k,{placeholder:"请输入资产编码"})}),t.jsx(i.Item,{name:"assetType",label:"资产类型",rules:[{required:!0,message:"请选择资产类型"}],children:t.jsx(f,{placeholder:"请选择资产类型",options:u})}),t.jsx(i.Item,{name:"status",label:"资产状态",rules:[{required:!0,message:"请选择资产状态"}],children:t.jsx(f,{placeholder:"请选择资产状态",options:x})}),t.jsx(i.Item,{name:"quantity",label:"数量",rules:[{required:!0,message:"请输入数量"}],children:t.jsx(k,{type:"number",placeholder:"请输入数量"})}),t.jsx(i.Item,{name:"tagId",label:"标签",rules:[{required:!0,message:"请选择标签"}],children:t.jsx(f,{placeholder:"请选择标签",options:m})})]})})]})},re=n.memo(ee);export{re as default};
