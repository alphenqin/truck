import{Z as U,r,j as o,h0 as W,he as X,hg as j,hb as A,S}from"./vendor-core-BL9Phd6R.js";import{A as c}from"./route-login-r9SQJoz-.js";import"./route-layout-BrOgEPTf.js";const Y=()=>c.get({url:"/monitor/store/list"}),G=a=>c.post({url:"/monitor/group/list",data:a}),ee=a=>c.post({url:"/monitor/asset/list",data:a}),te=a=>c.post({url:"/monitor/ag/update",data:a}),se=a=>c.post({url:"/monitor/gs/update",data:a}),{Option:g}=S,le=()=>{const[a,z]=U.useMessage(),[h,T]=r.useState("1"),[v,P]=r.useState([]),[k,b]=r.useState(0),[u,D]=r.useState(1),[i,E]=r.useState(10),[N,K]=r.useState([]),[m,f]=r.useState([]),[L,y]=r.useState(0),[d,R]=r.useState(1),[l,B]=r.useState(10),[ae,I]=r.useState(!1),[J,p]=r.useState(!1),[M,x]=r.useState(!1);r.useEffect(()=>{(async()=>{I(!0),p(!0);try{const s=await Y();K(s.data);const n=await G({limit:l,offset:0});f(n.data.list),y(n.data.total)}catch(s){console.error("初始化数据失败:",s),a.error("初始化数据失败")}finally{I(!1),p(!1)}})()},[]);const w=async(e,s)=>{x(!0);try{const t={limit:s,offset:(e-1)*s},n=await ee(t);P(n.data.list),b(n.data.total)}catch(t){console.error("获取资产列表失败:",t),a.error("获取资产列表失败")}finally{x(!1)}},C=async(e,s)=>{p(!0);try{const t={limit:s,offset:(e-1)*s},n=await G(t);f(n.data.list),y(n.data.total)}catch(t){console.error("获取班组列表失败:",t),a.error("获取班组列表失败")}finally{p(!1)}};r.useEffect(()=>{h==="1"?w(u,i):C(d,l)},[h,u,i,d,l]);const Q=e=>{e.current&&e.pageSize&&(D(e.current),E(e.pageSize))},_=e=>{e.current&&e.pageSize&&(R(e.current),B(e.pageSize))},$=async(e,s)=>{try{await te({assetId:e,groupId:s||0}),a.success("更新成功"),w(u,i)}catch(t){console.error("更新失败:",t),a.error("更新失败")}},q=async(e,s)=>{try{await se({groupId:e,storeId:s}),a.success("更新成功"),C(d,l)}catch(t){console.error("更新失败:",t),a.error("更新失败")}},F=[{title:"资产ID",dataIndex:"assetId",key:"assetId"},{title:"资产编码",dataIndex:"assetCode",key:"assetCode"},{title:"所属班组",key:"groupId",render:(e,s)=>o.jsxs(S,{value:s.groupId,onChange:t=>$(s.assetId,t),style:{width:200},placeholder:"请选择班组",children:[o.jsx(g,{value:null,children:"未分配"}),m.map(t=>o.jsx(g,{value:t.groupId,children:t.groupName},t.groupId))]})}],H=[{title:"班组ID",dataIndex:"groupId",key:"groupId"},{title:"班组名称",dataIndex:"groupName",key:"groupName"},{title:"所属场库",key:"storeId",render:(e,s)=>o.jsxs(S,{value:s.storeId||0,onChange:t=>q(s.groupId,t),style:{width:200},placeholder:"请选择场库",children:[o.jsx(g,{value:0,children:"未分配"}),N.map(t=>o.jsx(g,{value:t.StoreId,children:t.StoreName},t.StoreId))]})}],O=()=>o.jsx(j,{direction:"vertical",size:"large",style:{width:"100%"},children:o.jsx(A,{columns:F,dataSource:v,rowKey:"assetId",loading:M,pagination:{current:u,pageSize:i,total:k,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条`},onChange:Q})}),V=()=>o.jsx(j,{direction:"vertical",size:"large",style:{width:"100%"},children:o.jsx(A,{columns:H,dataSource:m,rowKey:"groupId",loading:J,pagination:{current:d,pageSize:l,total:L,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条`},onChange:_})}),Z=[{key:"1",label:"资产-班组绑定",children:o.jsx(O,{})},{key:"2",label:"班组-场库绑定",children:o.jsx(V,{})}];return o.jsxs(W,{children:[z,o.jsx(X,{activeKey:h,onChange:T,items:Z})]})};export{le as default};
