import{h6 as z,r as n,j as e,Y as D,h7 as L,V as m,S as f,ha as N,hb as _,hc as B,l,hl as H}from"./vendor-core-BL9Phd6R.js";import{A as y}from"./route-login-r9SQJoz-.js";import{u as K}from"./useSearchForm-DGLxIQDe.js";import"./route-layout-BrOgEPTf.js";const W=a=>y.post({url:"/iot/gateway/query",data:a}),Y=a=>y.post({url:"/iot/gateway",data:a}),$=(a,o)=>y.patch({url:`/iot/gateway/update/${a}`,data:o}),J=a=>y.delete({url:"/iot/gateway/batch-delete",data:a}),Q=a=>y.post({url:"/iot/gateway/export",data:{ids:a},responseType:"blob"}),U=()=>{const[a]=z(),[o,x]=n.useState(10),[p,h]=n.useState(1),[b,j]=n.useState(0),[C,g]=n.useState(!1),[w,S]=n.useState([]),[I,F]=n.useState([]),[r,i]=n.useState(),[d,q]=n.useState(!1),[G,u]=n.useState(!1),T=[{label:"网关名称",name:"gatewayName",component:e.jsx(m,{allowClear:!0})},{label:"网关编号",name:"gatewayCode",component:e.jsx(m,{allowClear:!0})},{label:"网关类型",name:"gatewayType",component:e.jsx(f,{allowClear:!0,options:[{label:"入库",value:1},{label:"出库",value:2},{label:"盘点",value:3}]})},{label:"状态",name:"status",component:e.jsx(f,{allowClear:!0,options:[{label:"启用",value:1},{label:"停止",value:2}]})}],{SearchFormComponent:R}=K({getDataRequestFn:t=>{const s={...t};c(s)},onNewRecordFn:()=>{a.resetFields(),q(!1),u(!0)},formItems:T,operateComponent:!!w.length&&e.jsx(D,{type:"primary",icon:e.jsx(L,{}),onClick:()=>Q(w.map(String)),children:"导出"}),formName:"gatewaySearchForm"}),c=t=>{g(!0);const s={limit:o,offset:(p-1)*o};t&&(t.id&&(s.id=t.id),t.gatewayName&&(s.gatewayName=t.gatewayName),t.gatewayCode&&(s.gatewayCode=t.gatewayCode),t.gatewayType&&(s.gatewayType=t.gatewayType),t.status!==void 0&&(s.status=t.status)),W(s).then(v=>{const M=v.data.list.map(k=>({...k,id:k.id??k.gatewayId}));F(M),j(v.data.total)}).finally(()=>{g(!1)})},E=t=>{N.confirm({title:"确认删除",content:"确定要删除该网关吗？",okText:"确认",cancelText:"取消",onOk:()=>{J([t]).then(()=>c())}})},P=async t=>{i(t),q(!0),u(!0)},A=()=>{a.validateFields().then(t=>{const s={...t};d&&r?(s.id=r.id,$(r.id,s).then(()=>{u(!1),c()})):Y(s).then(()=>{u(!1),c()})})},O=[{title:"ID",dataIndex:"id",key:"id"},{title:"网关名称",dataIndex:"gatewayName",key:"gatewayName"},{title:"网关编号",dataIndex:"gatewayCode",key:"gatewayCode"},{title:"网关类型",dataIndex:"gatewayType",key:"gatewayType",render:t=>({1:"入库",2:"出库",3:"盘点"})[t]||t},{title:"IP地址",dataIndex:"ipAddress",key:"ipAddress"},{title:"端口",dataIndex:"port",key:"port"},{title:"状态",dataIndex:"status",key:"status",render:t=>t===1?"启用":t===2?"停止":""},{title:"操作",key:"action",align:"center",render:(t,s)=>e.jsxs("div",{className:"gap-2 flex text-[#5bb4ef] items-center cursor-pointer justify-center",children:[e.jsx("span",{onClick:()=>P(s),children:"编辑"}),e.jsx("span",{className:"text-red-500",onClick:()=>E(s.id),children:"删除"})]})}];return n.useEffect(()=>{G&&d&&a.setFieldsValue(r)},[G]),n.useEffect(()=>{c()},[o,p]),{list:I,gatewayColumns:O,SearchFormComponent:R,total:b,limit:o,loading:C,isEdit:d,formRef:a,editGatewayModalOpen:G,setPage:h,setLimit:x,setSelected:S,setEditGatewayModalOpen:u,onFinish:A}},X=()=>{const{list:a,gatewayColumns:o,SearchFormComponent:x,total:p,limit:h,loading:b,isEdit:j,formRef:C,editGatewayModalOpen:g,setPage:w,setLimit:S,setSelected:I,setEditGatewayModalOpen:F,onFinish:r}=U();return e.jsxs(e.Fragment,{children:[x,e.jsx(_,{dataSource:a,rowSelection:{onChange:i=>{I(i)}},loading:b,columns:o,bordered:!0,pagination:!1,rowKey:"id"}),e.jsx(B,{total:p,className:"flex justify-end mt-2",pageSize:h,onChange:i=>w(i),showSizeChanger:!0,onShowSizeChange:(i,d)=>S(d)}),e.jsx(N,{open:g,title:j?"编辑":"新增",onOk:r,onCancel:()=>F(!1),children:e.jsxs(l,{form:C,autoComplete:"off",labelAlign:"left",id:"editFormRef",children:[e.jsx(l.Item,{name:"gatewayName",label:"网关名称",rules:[{required:!0}],children:e.jsx(m,{})}),e.jsx(l.Item,{name:"gatewayCode",label:"网关编号",rules:[{required:!0}],children:e.jsx(m,{})}),e.jsx(l.Item,{name:"gatewayType",label:"网关类型",rules:[{required:!0}],children:e.jsx(f,{options:[{label:"入库",value:1},{label:"出库",value:2},{label:"盘点",value:3}]})}),e.jsx(l.Item,{name:"ipAddress",label:"IP地址",rules:[{required:!0}],children:e.jsx(m,{})}),e.jsx(l.Item,{name:"port",label:"端口",rules:[{required:!0}],children:e.jsx(H,{style:{width:"100%"}})}),e.jsx(l.Item,{name:"status",label:"状态",rules:[{required:!0}],children:e.jsx(f,{options:[{label:"启用",value:1},{label:"停止",value:2}]})})]})})]})},ae=n.memo(X);export{ae as default};
