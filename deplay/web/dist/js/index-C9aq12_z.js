import{r as a,j as t}from"./vendor-react-BvY5jkjb.js";import{A as c}from"./route-login-BWcqE1fc.js";import{u as T}from"./useSearchForm-DVBHnHbJ.js";import"./vendor-common-DvYBgWFG.js";import{G as A,o as z,H as L,l as p,N as k,O as H,Q as _,F as y}from"./vendor-antd-VwCNQJi5.js";import"./route-layout-33ldzD5l.js";import"./vendor-redux-D__shqzO.js";import"./vendor-router-C3iwmVt3.js";const B=e=>c.post({url:"/base/department/query",data:e}),G=e=>c.post({url:"/base/department",data:e}),K=(e,n)=>c.patch({url:"/base/department/update",data:{...n,departmentId:e}}),Q=e=>c.delete({url:"/base/department/batch-delete",data:e}),V=e=>c.post({url:"/base/department/export",data:{ids:e},responseType:"blob"}),v=()=>{const[e]=A(),[n,I]=a.useState(10),[u,h]=a.useState(1),[g,b]=a.useState(0),[D,f]=a.useState(!1),[x,j]=a.useState([]),[S,F]=a.useState([]),[r,o]=a.useState(),[m,N]=a.useState(!1),[C,l]=a.useState(!1),E=[{label:"部门ID",name:"departmentId",component:t.jsx(p,{allowClear:!0,type:"number",min:0})},{label:"部门名称",name:"departmentName",component:t.jsx(p,{allowClear:!0})},{label:"场库ID",name:"storeId",component:t.jsx(p,{allowClear:!0,type:"number",min:0})}],{SearchFormComponent:q}=T({getDataRequestFn:s=>i(s),onNewRecordFn:()=>{N(!1),o(void 0),e.resetFields(),l(!0)},formItems:E,operateComponent:!!x.length&&t.jsx(z,{type:"primary",icon:t.jsx(L,{}),onClick:()=>V(x.map(s=>Number(s))),children:"导出"}),formName:"departmentSearchForm"}),i=s=>{f(!0);const d={...s,departmentId:s?.departmentId?Number(s.departmentId):void 0,storeId:s?.storeId?Number(s.storeId):void 0};B({limit:n,offset:(u-1)*n,...d}).then(R=>{F(R.data.list),b(R.data.total)}).finally(()=>{f(!1)})},w=s=>{k.confirm({title:"确认删除",content:"确定要删除这个部门吗？",okText:"确认",cancelText:"取消",onOk:()=>{Q([s]).then(()=>i())}})},O=async s=>{o(s),N(!0),e.resetFields(),l(!0)},P=()=>{e.validateFields().then(s=>{const d={...s,storeId:Number(s.storeId)};m&&r?K(r.departmentId,d).then(()=>{l(!1),e.resetFields(),i()}):G(d).then(()=>{l(!1),e.resetFields(),i()})})},M=[{title:"部门ID",dataIndex:"departmentId",key:"departmentId"},{title:"部门名称",dataIndex:"departmentName",key:"departmentName"},{title:"场库ID",dataIndex:"storeId",key:"storeId"},{title:"操作",key:"action",align:"center",render:(s,d)=>t.jsxs("div",{className:"gap-2 flex text-[#5bb4ef] items-center cursor-pointer justify-center",children:[t.jsx("span",{onClick:()=>O(d),children:"编辑"}),t.jsx("span",{className:"text-red-500",onClick:()=>w(d.departmentId),children:"删除"})]})}];return a.useEffect(()=>{C&&m&&r&&e.setFieldsValue(r)},[C,m,r]),a.useEffect(()=>{i()},[n,u]),{list:S,roleColumns:M,SearchFormComponent:q,total:g,limit:n,loading:D,isEdit:m,formRef:e,editDepartmentsModalOpen:C,setPage:h,setLimit:I,setSelected:j,setEditDepartmentsModalOpen:l,onFinish:P}},J=()=>{const{list:e,roleColumns:n,SearchFormComponent:I,total:u,limit:h,loading:g,isEdit:b,formRef:D,editDepartmentsModalOpen:f,setPage:x,setLimit:j,setSelected:S,setEditDepartmentsModalOpen:F,onFinish:r}=v();return t.jsxs(t.Fragment,{children:[I,t.jsx(H,{dataSource:e,rowSelection:{onChange:o=>{S(o)}},loading:g,columns:n,bordered:!0,pagination:!1,rowKey:"departmentId"}),t.jsx(_,{total:u,className:"flex justify-end mt-2",pageSize:h,onChange:o=>x(o),showSizeChanger:!0,onShowSizeChange:(o,m)=>j(m)}),t.jsx(k,{open:f,title:b?"编辑部门":"新增部门",onOk:r,onCancel:()=>F(!1),children:t.jsxs(y,{form:D,autoComplete:"off",labelAlign:"left",id:"editFormRef",children:[t.jsx(y.Item,{name:"departmentName",label:"部门名称",rules:[{required:!0,message:"请输入部门名称"}],children:t.jsx(p,{})}),t.jsx(y.Item,{name:"storeId",label:"场库ID",rules:[{required:!0,message:"请输入场库ID"}],children:t.jsx(p,{type:"number"})})]})})]})},se=a.memo(J);export{se as default};
