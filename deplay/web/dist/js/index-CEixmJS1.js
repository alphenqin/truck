import{h6 as z,r as o,j as e,Y as b,h7 as A,ha as C,Z as w,V as E,hb as B,hc as V,l as k,hl as _}from"./vendor-core-BL9Phd6R.js";import{A as d}from"./route-login-p179xrQD.js";import{u as v}from"./useSearchForm-DGLxIQDe.js";import"./route-layout-De7MC9tK.js";const H=t=>d.post({url:"/sl/store/query",data:t}),Y=t=>d.post({url:"/sl/store",data:t}),q=t=>d.delete({url:"/sl/store/batch-delete",data:t}),Z=t=>d.patch({url:"/sl/store/update",data:t}),G=t=>d.post({url:"/sl/store/export",data:{ids:t},responseType:"blob"}),J=()=>{const[t]=z(),[n,g]=o.useState(10),[u,S]=o.useState(1),[x,y]=o.useState(0),[j,m]=o.useState(!1),[r,h]=o.useState([]),[I,F]=o.useState([]),[p,R]=o.useState(),[a,f]=o.useState(!1),[N,i]=o.useState(!1),T=[{label:"场库名称",name:"storeName",component:e.jsx(E,{allowClear:!0})}],{SearchFormComponent:O}=v({getDataRequestFn:s=>l(s),onNewRecordFn:()=>{f(!1),t.resetFields(),i(!0)},formItems:T,operateComponent:r.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(b,{danger:!0,style:{marginRight:8},onClick:()=>D(),children:"批量删除"}),e.jsx(b,{type:"primary",icon:e.jsx(A,{}),onClick:()=>G(r),children:"导出"})]}),formName:"storeSearchForm"}),l=s=>{m(!0),H({limit:n,offset:(u-1)*n,...s}).then(c=>{F(c.data.list),y(c.data.total)}).finally(()=>{m(!1)})},D=()=>{C.confirm({title:"确认删除",content:"确定要删除选中的场库吗？",okText:"删除",okType:"danger",cancelText:"取消",onOk:async()=>{await q(r),w.success("删除成功"),h([]),l()}})},M=s=>{C.confirm({title:"确认删除",content:"确定要删除该场库吗？",okText:"删除",okType:"danger",cancelText:"取消",onOk:async()=>{await q([s]),w.success("删除成功"),l()}})},P=async s=>{R(s),f(!0),i(!0),t.setFieldsValue(s)},K=()=>{t.validateFields().then(s=>{a&&p?Z({...s,storeId:p.storeId}).then(()=>{i(!1),l()}):Y(s).then(()=>{i(!1),l()})})},L=[{title:"场库ID",dataIndex:"storeId",key:"storeId"},{title:"场库名称",dataIndex:"storeName",key:"storeName"},{title:"园区ID",dataIndex:"gardenId",key:"gardenId"},{title:"操作",key:"action",align:"center",render:(s,c)=>e.jsxs("div",{className:"gap-2 flex text-[#5bb4ef] items-center cursor-pointer justify-center",children:[e.jsx("span",{onClick:()=>P(c),children:"编辑"}),e.jsx("span",{className:"text-red-500",onClick:()=>M(c.storeId),children:"删除"})]})}];return o.useEffect(()=>{l()},[n,u]),{list:I,columns:L,SearchFormComponent:O,total:x,limit:n,loading:j,isEdit:a,formRef:t,editStoreModalOpen:N,setPage:S,setLimit:g,setSelectedRowKeys:h,selectedRowKeys:r,setEditStoreModalOpen:i,onFinish:K}},Q=()=>{const{list:t,columns:n,SearchFormComponent:g,total:u,limit:S,loading:x,isEdit:y,formRef:j,editStoreModalOpen:m,setPage:r,setLimit:h,setSelectedRowKeys:I,selectedRowKeys:F,setEditStoreModalOpen:p,onFinish:R}=J();return e.jsxs(e.Fragment,{children:[g,e.jsx(B,{dataSource:t,rowSelection:{selectedRowKeys:F,onChange:a=>I(a)},loading:x,columns:n,bordered:!0,pagination:!1,rowKey:"storeId"}),e.jsx(V,{total:u,className:"flex justify-end mt-2",pageSize:S,onChange:a=>r(a),showSizeChanger:!0,onShowSizeChange:(a,f)=>h(f)}),e.jsx(C,{open:m,title:y?"编辑":"新增",onOk:R,onCancel:()=>p(!1),children:e.jsxs(k,{form:j,autoComplete:"off",labelAlign:"left",id:"editFormRef",children:[e.jsx(k.Item,{name:"storeName",label:"场库名称",rules:[{required:!0}],children:e.jsx(E,{})}),e.jsx(k.Item,{name:"gardenId",label:"园区id",rules:[{required:!0,type:"number",message:"园区id必须为数字"}],children:e.jsx(_,{style:{width:"100%"}})})]})})]})},ee=o.memo(Q);export{ee as default};
