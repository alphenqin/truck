import{r as o,j as e}from"./vendor-react-BvY5jkjb.js";import{A as c}from"./route-login-BWcqE1fc.js";import{u as z}from"./useSearchForm-DVBHnHbJ.js";import"./vendor-common-DvYBgWFG.js";import{G as A,o as b,H as B,N as C,s as w,l as q,O as H,Q as _,F as k,a0 as v}from"./vendor-antd-VwCNQJi5.js";import"./route-layout-33ldzD5l.js";import"./vendor-redux-D__shqzO.js";import"./vendor-router-C3iwmVt3.js";const G=t=>c.post({url:"/sl/store/query",data:t}),Q=t=>c.post({url:"/sl/store",data:t}),N=t=>c.delete({url:"/sl/store/batch-delete",data:t}),V=t=>c.patch({url:"/sl/store/update",data:t}),J=t=>c.post({url:"/sl/store/export",data:{ids:t},responseType:"blob"}),U=()=>{const[t]=A(),[r,g]=o.useState(10),[u,S]=o.useState(1),[x,y]=o.useState(0),[j,m]=o.useState(!1),[n,p]=o.useState([]),[I,F]=o.useState([]),[f,R]=o.useState(),[a,h]=o.useState(!1),[E,i]=o.useState(!1),T=[{label:"场库名称",name:"storeName",component:e.jsx(q,{allowClear:!0})}],{SearchFormComponent:O}=z({getDataRequestFn:s=>l(s),onNewRecordFn:()=>{h(!1),t.resetFields(),i(!0)},formItems:T,operateComponent:n.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(b,{danger:!0,style:{marginRight:8},onClick:()=>D(),children:"批量删除"}),e.jsx(b,{type:"primary",icon:e.jsx(B,{}),onClick:()=>J(n),children:"导出"})]}),formName:"storeSearchForm"}),l=s=>{m(!0),G({limit:r,offset:(u-1)*r,...s}).then(d=>{F(d.data.list),y(d.data.total)}).finally(()=>{m(!1)})},D=()=>{C.confirm({title:"确认删除",content:"确定要删除选中的场库吗？",okText:"删除",okType:"danger",cancelText:"取消",onOk:async()=>{await N(n),w.success("删除成功"),p([]),l()}})},M=s=>{C.confirm({title:"确认删除",content:"确定要删除该场库吗？",okText:"删除",okType:"danger",cancelText:"取消",onOk:async()=>{await N([s]),w.success("删除成功"),l()}})},P=async s=>{R(s),h(!0),i(!0),t.setFieldsValue(s)},K=()=>{t.validateFields().then(s=>{a&&f?V({...s,storeId:f.storeId}).then(()=>{i(!1),l()}):Q(s).then(()=>{i(!1),l()})})},L=[{title:"场库ID",dataIndex:"storeId",key:"storeId"},{title:"场库名称",dataIndex:"storeName",key:"storeName"},{title:"园区ID",dataIndex:"gardenId",key:"gardenId"},{title:"操作",key:"action",align:"center",render:(s,d)=>e.jsxs("div",{className:"gap-2 flex text-[#5bb4ef] items-center cursor-pointer justify-center",children:[e.jsx("span",{onClick:()=>P(d),children:"编辑"}),e.jsx("span",{className:"text-red-500",onClick:()=>M(d.storeId),children:"删除"})]})}];return o.useEffect(()=>{l()},[r,u]),{list:I,columns:L,SearchFormComponent:O,total:x,limit:r,loading:j,isEdit:a,formRef:t,editStoreModalOpen:E,setPage:S,setLimit:g,setSelectedRowKeys:p,selectedRowKeys:n,setEditStoreModalOpen:i,onFinish:K}},W=()=>{const{list:t,columns:r,SearchFormComponent:g,total:u,limit:S,loading:x,isEdit:y,formRef:j,editStoreModalOpen:m,setPage:n,setLimit:p,setSelectedRowKeys:I,selectedRowKeys:F,setEditStoreModalOpen:f,onFinish:R}=U();return e.jsxs(e.Fragment,{children:[g,e.jsx(H,{dataSource:t,rowSelection:{selectedRowKeys:F,onChange:a=>I(a)},loading:x,columns:r,bordered:!0,pagination:!1,rowKey:"storeId"}),e.jsx(_,{total:u,className:"flex justify-end mt-2",pageSize:S,onChange:a=>n(a),showSizeChanger:!0,onShowSizeChange:(a,h)=>p(h)}),e.jsx(C,{open:m,title:y?"编辑":"新增",onOk:R,onCancel:()=>f(!1),children:e.jsxs(k,{form:j,autoComplete:"off",labelAlign:"left",id:"editFormRef",children:[e.jsx(k.Item,{name:"storeName",label:"场库名称",rules:[{required:!0}],children:e.jsx(q,{})}),e.jsx(k.Item,{name:"gardenId",label:"园区id",rules:[{required:!0,type:"number",message:"园区id必须为数字"}],children:e.jsx(v,{style:{width:"100%"}})})]})})]})},ae=o.memo(W);export{ae as default};
