import{l,Z as D,r,j as t,V as F,Y as g,hp as H,hb as P,gU as j,hg as R}from"./vendor-core-BL9Phd6R.js";import{A as C}from"./route-login-r9SQJoz-.js";import"./route-layout-BrOgEPTf.js";const q={1:"正常在库",2:"正常出库",3:"异常待修",4:"维修中",5:"报废",6:"呆滞",7:"疑似丢失"},v={1:"工装车",2:"牵引车"},U=o=>C.post({url:"/asset/query",data:o}),b=o=>C.post({url:"/asset/update/type",data:o}),N=()=>{const[o]=l.useForm(),[n,S]=D.useMessage(),[k,i]=r.useState([]),[h,f]=r.useState(!1),[c,x]=r.useState(!1),[u,A]=r.useState(1),[d,Y]=r.useState(10),[w,p]=r.useState(0),m=async()=>{const e=o.getFieldsValue();f(!0);try{const s={...e.assetCode&&{assetCode:e.assetCode},limit:d,offset:(u-1)*d},a=await U(s);a&&a.data&&Array.isArray(a.data.list)?(i(a.data.list),p(a.data.total)):(i([]),p(0),n.info("未找到该资产或查询结果为空。"))}catch(s){console.error("查询资产失败:",s),i([]),p(0),n.error("查询资产失败。")}finally{f(!1)}},M=(e,s)=>{A(e),s!==void 0&&Y(s)};r.useEffect(()=>{m()},[u,d]);const I=async(e,s)=>{x(!0);try{const y=await b({assetId:e,status:s});console.log("Update status response:",y),y?.code===200?(n.success("资产状态更新成功！"),m()):n.error(`资产状态更新失败: ${y?.msg||"未知错误"}`)}catch{n.error("更新资产状态失败。")}finally{x(!1)}},T=[{title:"资产ID",dataIndex:"assetId",key:"assetId"},{title:"资产编码",dataIndex:"assetCode",key:"assetCode"},{title:"资产类型",dataIndex:"assetType",key:"assetType",render:e=>v[e]||e},{title:"当前状态",dataIndex:"status",key:"status",render:e=>q[e]||e},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",render:e=>e?j(e).format("YYYY-MM-DD HH:mm:ss"):"-"},{title:"更新时间",dataIndex:"updatedAt",key:"updatedAt",render:e=>e?j(e).format("YYYY-MM-DD HH:mm:ss"):"-"},{title:"操作",key:"actions",render:(e,s)=>t.jsxs(R,{size:"small",children:[t.jsx(g,{type:"link",danger:!0,onClick:()=>I(s.assetId,3),loading:c,children:"报修"}),t.jsx(g,{type:"link",danger:!0,onClick:()=>I(s.assetId,5),loading:c,children:"报废"})]})}];return t.jsxs("div",{className:"p-6",children:[S,t.jsxs(l,{form:o,onFinish:m,layout:"inline",children:[t.jsx(l.Item,{name:"assetCode",rules:[{required:!1,message:"请输入资产编码"}],children:t.jsx(F,{placeholder:"请输入资产编码",allowClear:!0})}),t.jsx(l.Item,{children:t.jsx(g,{type:"primary",htmlType:"submit",loading:h,icon:t.jsx(H,{}),children:"查询"})})]}),t.jsx(P,{columns:T,dataSource:k,rowKey:"assetId",loading:h||c,className:"mt-4",pagination:{current:u,pageSize:d,total:w,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`,onChange:M}})]})};export{N as default};
