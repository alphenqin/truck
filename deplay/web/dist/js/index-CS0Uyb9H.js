import{r as o,j as t}from"./vendor-react-BvY5jkjb.js";import{e4 as P}from"./vendor-common-DvYBgWFG.js";import{A as p}from"./route-login-BWcqE1fc.js";import{F as n,Y as z,w,x as r,J as B,S as d,l as j,X as A,o as m,a4 as K,a8 as L,a9 as Y,O as $,s as x,N as b}from"./vendor-antd-VwCNQJi5.js";import"./route-layout-33ldzD5l.js";import"./vendor-redux-D__shqzO.js";import"./vendor-router-C3iwmVt3.js";const T={0:"未知异常",1:"工装车厂房不匹配",2:"牵引车厂房不匹配"},S={0:"未处理",1:"已处理"},J=a=>p.post({url:"/asset/exception/flow/list",data:a}),V=a=>p.post({url:"/asset/exception/handle",data:a}),_=a=>p.post({url:"/asset/exception/batchHandle",data:a}),q=a=>p.post({url:"/asset/exception/export",data:a}),{RangePicker:Q}=B,se=()=>{const[a]=n.useForm(),[D,H]=o.useState([]),[g,f]=o.useState(!1),[M,R]=o.useState(0),[u,C]=o.useState(1),[i,E]=o.useState(10),[h,y]=o.useState([]),[F,I]=o.useState(!1),c=async()=>{f(!0);try{const e=a.getFieldsValue(),s={limit:i,offset:(u-1)*i,startTime:e.timeRange?.[0]?.format("YYYY-MM-DD HH:mm:ss"),endTime:e.timeRange?.[1]?.format("YYYY-MM-DD HH:mm:ss"),exceptionType:e.exceptionType,status:e.status,assetId:e.assetId},l=await J(s);l.code===200&&(H(l.data.list),R(l.data.total))}catch{x.error("查询失败")}finally{f(!1)}};o.useEffect(()=>{c()},[u,i]);const N=e=>{b.confirm({title:"处理异常",content:t.jsx(n,{layout:"vertical",id:"handleForm",children:t.jsx(n.Item,{name:"handleNote",label:"处理备注",children:t.jsx(j.TextArea,{})})}),onOk:async()=>{const s=document.getElementById("handleForm")?.handleNote?.value||"";await V({id:e.id.toString(),status:1,handleNote:s}),x.success("处理成功"),c()}})},k=()=>{b.confirm({title:"批量处理异常",content:t.jsx(n,{layout:"vertical",id:"batchHandleForm",children:t.jsx(n.Item,{name:"handleNote",label:"处理备注",children:t.jsx(j.TextArea,{})})}),onOk:async()=>{const e=document.getElementById("batchHandleForm")?.handleNote?.value||"";await _({ids:h,status:1,handleNote:e}),x.success("批量处理成功"),y([]),c()}})},v=async()=>{I(!0);try{const e=a.getFieldsValue(),s={limit:1e4,offset:0,startTime:e.timeRange?.[0]?.format("YYYY-MM-DD HH:mm:ss"),endTime:e.timeRange?.[1]?.format("YYYY-MM-DD HH:mm:ss"),exceptionType:e.exceptionType,status:e.status,assetId:e.assetId},l=await q(s);l.code===200&&l.data&&window.open(l.data,"_blank")}catch{x.error("导出失败")}finally{I(!1)}},O=[{title:"异常类型",dataIndex:"exceptionType",render:e=>T[e]},{title:"资产ID",dataIndex:"assetId"},{title:"检测时间",dataIndex:"detectionTime",render:e=>e?P(e).format("YYYY-MM-DD HH:mm:ss"):"-"},{title:"状态",dataIndex:"status",render:e=>S[e]},{title:"异常内容",dataIndex:"exceptionNote",render:e=>e||"-"},{title:"备注",dataIndex:"remark",render:e=>e||"-"},{title:"操作",dataIndex:"action",render:(e,s)=>s.status===0?t.jsx(m,{type:"link",icon:t.jsx(Y,{}),onClick:()=>N(s),children:"处理"}):t.jsx("span",{style:{color:"#aaa"},children:"已处理"})}];return t.jsx("div",{className:"p-6",children:t.jsxs(z,{children:[t.jsxs(n,{form:a,layout:"vertical",onFinish:c,children:[t.jsxs(w,{gutter:[16,16],children:[t.jsx(r,{xs:24,sm:12,md:8,lg:6,children:t.jsx(n.Item,{name:"timeRange",label:"时间范围",children:t.jsx(Q,{showTime:!0,style:{width:"100%"}})})}),t.jsx(r,{xs:24,sm:12,md:8,lg:6,children:t.jsx(n.Item,{name:"exceptionType",label:"异常类型",children:t.jsx(d,{allowClear:!0,placeholder:"请选择异常类型",children:Object.entries(T).map(([e,s])=>t.jsx(d.Option,{value:Number(e),children:s},e))})})}),t.jsx(r,{xs:24,sm:12,md:8,lg:6,children:t.jsx(n.Item,{name:"status",label:"处理状态",children:t.jsx(d,{allowClear:!0,placeholder:"请选择处理状态",children:Object.entries(S).map(([e,s])=>t.jsx(d.Option,{value:Number(e),children:s},e))})})}),t.jsx(r,{xs:24,sm:12,md:8,lg:6,children:t.jsx(n.Item,{name:"assetId",label:"资产ID",children:t.jsx(j,{allowClear:!0,placeholder:"请输入资产ID"})})})]}),t.jsx(w,{children:t.jsx(r,{span:24,children:t.jsx(n.Item,{children:t.jsxs(A,{size:"middle",children:[t.jsx(m,{type:"primary",htmlType:"submit",icon:t.jsx(K,{}),loading:g,children:"查询"}),t.jsx(m,{icon:t.jsx(L,{}),onClick:v,loading:F,children:"导出"}),t.jsx(m,{type:"default",disabled:h.length===0,onClick:k,icon:t.jsx(Y,{}),children:"批量处理"})]})})})})]}),t.jsx($,{className:"mt-6",columns:O,dataSource:D,rowKey:"id",loading:g,rowSelection:{selectedRowKeys:h,onChange:y,getCheckboxProps:e=>({disabled:e.status===1})},pagination:{current:u,pageSize:i,total:M,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`,onChange:(e,s)=>{C(e),E(s||10)}}})]})})};export{se as default};
