import{j as e,r as a}from"./vendor-react-BvY5jkjb.js";import{l as te,m as se,n as v,o as ae,p as ne,c as re,q as oe,r as le,s as ie}from"./route-login-BWcqE1fc.js";import{e4 as L,M as ce}from"./vendor-common-DvYBgWFG.js";import{a as c}from"./route-layout-33ldzD5l.js";import{A as E}from"./index-BXJhWmd9.js";import{F as d,K as Y,l as g,_ as V,S as p,J as H,N as z,o as de,H as me,O as ue,Q as pe}from"./vendor-antd-VwCNQJi5.js";import{u as xe}from"./useSearchForm-DVBHnHbJ.js";import"./vendor-router-C3iwmVt3.js";import"./vendor-redux-D__shqzO.js";const he=(h,r)=>{const[D]=d.useForm(),[m]=d.useForm(),I=[{title:"序号",align:"center",hidden:r?.module===c.module.ROLE,render:(s,t,u)=>(x-1)*o+u+1},{title:"账号",dataIndex:"account",key:"account"},{title:"昵称",dataIndex:"nickname",key:"nickname"},{title:"角色",dataIndex:"isAdmin",key:"isAdmin",align:"center",render:(s,{isAdmin:t})=>e.jsx(Y,{color:t?"gold":"green",children:t?"系统账号":"普通账号"})},{title:"状态",dataIndex:"status",hidden:r?.module===c.module.ROLE,key:"status",align:"center",render:(s,{status:t,id:u})=>e.jsx(Y,{color:t==="1"?"green":"red",className:"cursor-pointer",onClick:()=>W({id:u,status:t==="1"?"0":"1"}),children:t==="1"?"启用":"禁用"})},{title:"创建时间",dataIndex:"createTime",key:"createTime",align:"center",render:(s,{createTime:t})=>e.jsx("span",{children:L(t).format("YYYY-MM-DD HH:mm:ss")})},{title:"更新时间",dataIndex:"updateTime",key:"updateTime",align:"center",render:(s,{updateTime:t})=>e.jsx("span",{children:L(t).format("YYYY-MM-DD HH:mm:ss")})},{title:"操作",key:"action",align:"center",render:(s,t)=>r?.module!==c.module.ROLE?e.jsxs("div",{className:"gap-2 flex text-[#5bb4ef] items-center cursor-pointer justify-center",children:[e.jsx(E,{permission:c.permissionDicMap.UPDATE_USER,children:e.jsx("span",{onClick:()=>P(t.id),children:"编辑"})}),e.jsx(E,{permission:c.permissionDicMap.DELETE_USER,children:e.jsx("span",{className:"text-red-500",onClick:()=>Z(t.id),children:"删除"})})]}):e.jsx("div",{className:"gap-2 flex text-[#5bb4ef] items-center cursor-pointer justify-center",children:e.jsx(E,{permission:c.permissionDicMap.BIND_USER,children:e.jsx("span",{onClick:()=>r?.operation&&r?.operation(t).then(()=>{i()}),children:"授权"})})})}],[R,k]=a.useState([]),[o,y]=a.useState(10),[x,l]=a.useState(1),[F,U]=a.useState(!1),[S,b]=a.useState([]),[O,q]=a.useState([]),[M,T]=a.useState(0),[_,A]=a.useState([]),[f,j]=a.useState(!1),[w,n]=a.useState(),[C,B]=a.useState(!0),K=[{label:"账号",name:"account",component:e.jsx(g,{allowClear:!0})},{label:"昵称",name:"nickname",component:e.jsx(g,{allowClear:!0})},{label:"部门",name:"departmentID",component:e.jsx(V,{allowClear:!0,treeData:R})},{label:"状态",name:"status",component:e.jsxs(p,{allowClear:!0,children:[e.jsx(p.Option,{value:"1",children:"开启"}),e.jsx(p.Option,{value:"0",children:"禁用"})]})},{label:"创建时间",name:"startTime",component:e.jsx(H,{allowClear:!0,style:{width:"100%"}})},{label:"更新时间",name:"endTime",component:e.jsx(H,{allowClear:!0,style:{width:"100%"}})}],J=s=>i(s),Q={id:"",account:"",nickname:"",password:"",departmentID:"",rolesID:[],status:"1"},X=()=>{D?.resetFields(),i()},i=s=>{U(!0),(r?.module===c.module.ROLE?()=>te({limit:o,offset:(x-1)*o,...s},r?.context):()=>se({limit:o,offset:(x-1)*o,...s}))().then(u=>{q(u.data.list),T(u.data.total)}).finally(()=>{U(!1)})},G=()=>{oe().then(s=>{k(N(s.data))})};function N(s){return s?.map(t=>({title:t.departmentName,key:t.id,value:t.id,children:t.children&&N(t.children)||[]}))||[]}const W=s=>{v(s).then(()=>i())},Z=s=>{z.confirm({title:"确认删除",content:"确定要删除该用户吗？",okText:"确定",cancelText:"取消",onOk:()=>{ae(s).then(()=>i())}})},$=async()=>{await ie(S)},P=async s=>{const{data:t}=s?await ne(s):{data:Q},{data:u}=await re();B(!!s),A(u.list),n(t),j(!0)};a.useEffect(()=>{f&&m.setFieldsValue(w)},[f]);const ee=async()=>{if(!await m.validateFields())return;const t={...m.getFieldsValue(),id:w?.id};m.getFieldsValue().password&&(t.password=ce.hashStr(m.getFieldsValue().password)),C?await v(t):await le(t),j(!1),i()};return a.useEffect(()=>{i()},[x,o]),a.useEffect(()=>{G()},[]),a.useImperativeHandle(h,()=>({getPageData:i})),{userPageRef:h,total:M,users:O,roles:_,departments:R,columns:I,editFormRef:m,editUserModalOpen:f,isEdit:C,limit:o,page:x,selected:S,searchConfig:K,loading:F,exportUsersAction:$,setSelected:b,getPageData:i,setLimit:y,setPage:l,onFinish:J,onReset:X,editUserConfirm:ee,setEditUserModalOpen:j,editUserAction:P}},fe=(h,r)=>{const{userPageRef:D,total:m,columns:I,departments:R,users:k,editFormRef:o,editUserModalOpen:y,roles:x,isEdit:l,limit:F,searchConfig:U,selected:S,loading:b,exportUsersAction:O,setSelected:q,getPageData:M,setPage:T,setLimit:_,editUserConfirm:A,setEditUserModalOpen:f,editUserAction:j}=he(r,h),{SearchFormComponent:w}=xe({getDataRequestFn:M,onNewRecordFn:j,formItems:U,operateComponent:!!S.length&&e.jsx(E,{permission:c.permissionDicMap.EXPORT_USER,children:e.jsx(de,{type:"primary",icon:e.jsx(me,{}),onClick:O,children:"导出"})}),formName:"userSearchForm",showAddBtn:h?.module!==c.module.ROLE});return e.jsxs("div",{ref:D,children:[w,e.jsx(ue,{dataSource:k,loading:b,columns:I,rowSelection:{onChange:n=>{q(n)}},bordered:!0,pagination:!1,rowKey:"id"}),e.jsx(pe,{total:m,className:"flex justify-end mt-2",pageSize:F,onChange:n=>T(n),showSizeChanger:!0,onShowSizeChange:(n,C)=>_(C)}),e.jsx(z,{destroyOnClose:!0,open:y,title:l?"编辑":"新增",onOk:A,onCancel:()=>f(!1),children:e.jsxs(d,{form:o,autoComplete:"off",labelAlign:"left",labelCol:{span:6},id:"editFormRef",children:[!l&&e.jsx(d.Item,{name:"account",label:"账号",rules:[{required:!l}],children:e.jsx(g,{})}),e.jsx(d.Item,{name:"nickname",label:"昵称",rules:[{required:!0}],children:e.jsx(g,{})}),e.jsx(d.Item,{name:"password",label:"密码",rules:[{required:!l}],children:e.jsx(g.Password,{})}),e.jsx(d.Item,{name:"departmentID",label:"部门",rules:[{required:!l}],children:e.jsx(V,{allowClear:!0,treeData:R})}),e.jsx(d.Item,{name:"rolesID",label:"角色",rules:[{required:!l}],children:e.jsx(p,{allowClear:!0,mode:"multiple",children:x?.map(n=>e.jsx(p.Option,{value:n.id,children:n.roleName},n.id))})}),e.jsx(d.Item,{name:"status",label:"状态",rules:[{required:!l}],children:e.jsxs(p,{children:[e.jsx(p.Option,{value:"0",children:"禁用"}),e.jsx(p.Option,{value:"1",children:"启用"})]})})]})})]})},Ie=a.memo(a.forwardRef(fe));export{Ie as default};
