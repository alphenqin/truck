import{r,j as s}from"./vendor-react-BvY5jkjb.js";import{A as C}from"./route-login-BWcqE1fc.js";import{e4 as j}from"./vendor-common-DvYBgWFG.js";import{F as l,s as F,l as D,o as g,a4 as H,O as P,X as R}from"./vendor-antd-VwCNQJi5.js";import"./route-layout-33ldzD5l.js";import"./vendor-redux-D__shqzO.js";import"./vendor-router-C3iwmVt3.js";const q={1:"正常在库",2:"正常出库",3:"异常待修",4:"维修中",5:"报废",6:"呆滞",7:"疑似丢失"},v={1:"工装车",2:"牵引车"},z=o=>C.post({url:"/asset/query",data:o}),E=o=>C.post({url:"/asset/update/type",data:o}),K=()=>{const[o]=l.useForm(),[n,S]=F.useMessage(),[k,i]=r.useState([]),[f,h]=r.useState(!1),[c,x]=r.useState(!1),[u,A]=r.useState(1),[d,w]=r.useState(10),[M,p]=r.useState(0),m=async()=>{const e=o.getFieldsValue();h(!0);try{const t={...e.assetCode&&{assetCode:e.assetCode},limit:d,offset:(u-1)*d},a=await z(t);a&&a.data&&Array.isArray(a.data.list)?(i(a.data.list),p(a.data.total)):(i([]),p(0),n.info("未找到该资产或查询结果为空。"))}catch(t){console.error("查询资产失败:",t),i([]),p(0),n.error("查询资产失败。")}finally{h(!1)}},Y=(e,t)=>{A(e),t!==void 0&&w(t)};r.useEffect(()=>{m()},[u,d]);const I=async(e,t)=>{x(!0);try{const y=await E({assetId:e,status:t});console.log("Update status response:",y),y?.code===200?(n.success("资产状态更新成功！"),m()):n.error(`资产状态更新失败: ${y?.msg||"未知错误"}`)}catch{n.error("更新资产状态失败。")}finally{x(!1)}},T=[{title:"资产ID",dataIndex:"assetId",key:"assetId"},{title:"资产编码",dataIndex:"assetCode",key:"assetCode"},{title:"资产类型",dataIndex:"assetType",key:"assetType",render:e=>v[e]||e},{title:"当前状态",dataIndex:"status",key:"status",render:e=>q[e]||e},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",render:e=>e?j(e).format("YYYY-MM-DD HH:mm:ss"):"-"},{title:"更新时间",dataIndex:"updatedAt",key:"updatedAt",render:e=>e?j(e).format("YYYY-MM-DD HH:mm:ss"):"-"},{title:"操作",key:"actions",render:(e,t)=>s.jsxs(R,{size:"small",children:[s.jsx(g,{type:"link",danger:!0,onClick:()=>I(t.assetId,3),loading:c,children:"报修"}),s.jsx(g,{type:"link",danger:!0,onClick:()=>I(t.assetId,5),loading:c,children:"报废"})]})}];return s.jsxs("div",{className:"p-6",children:[S,s.jsxs(l,{form:o,onFinish:m,layout:"inline",children:[s.jsx(l.Item,{name:"assetCode",rules:[{required:!1,message:"请输入资产编码"}],children:s.jsx(D,{placeholder:"请输入资产编码",allowClear:!0})}),s.jsx(l.Item,{children:s.jsx(g,{type:"primary",htmlType:"submit",loading:f,icon:s.jsx(H,{}),children:"查询"})})]}),s.jsx(P,{columns:T,dataSource:k,rowKey:"assetId",loading:f||c,className:"mt-4",pagination:{current:u,pageSize:d,total:M,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`,onChange:Y}})]})};export{K as default};
