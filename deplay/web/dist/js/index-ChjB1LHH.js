import{r as n,j as e}from"./vendor-react-BvY5jkjb.js";import{e as _e,c as Ae,u as $,d as Oe,f as we,h as Ne,i as Le,j as Fe,k as Ye}from"./route-login-BWcqE1fc.js";import{e4 as A}from"./vendor-common-DvYBgWFG.js";import{u as qe}from"./useSearchForm-DVBHnHbJ.js";import{G as Ke,o as J,H as He,l as U,J as ee,K as te,N as ie,O as se,Q as ne,F as G,U as ae,V as ve,W as re,X as Be,Y as le,Z as ze}from"./vendor-antd-VwCNQJi5.js";import{a as d,o as Ve,p as Xe,q as Ge,r as Je}from"./route-layout-33ldzD5l.js";import{g as Qe}from"./index-9dbmgGIM.js";import{A as p}from"./index-BXJhWmd9.js";import We from"./index-Cb9tpMV5.js";import"./vendor-router-C3iwmVt3.js";import"./vendor-redux-D__shqzO.js";const Ze=()=>{const C=n.useRef(null),[f]=Ke(),[o,O]=n.useState(10),[x,w]=n.useState(1),[N,L]=n.useState(0),[F,I]=n.useState(!1),[S,Y]=n.useState([]),[k,m]=n.useState([]),[D,T]=n.useState([]),[q,K]=n.useState([]),[H,v]=n.useState([]),[h,B]=n.useState([]),[a,R]=n.useState(),[u,E]=n.useState(!1),[g,c]=n.useState(!1),[z,j]=n.useState(!1),[V,M]=n.useState(!1),X=[{label:"角色ID",name:"id",component:e.jsx(U,{allowClear:!0})},{label:"角色名称",name:"roleName",component:e.jsx(U,{allowClear:!0})},{label:"角色描述",name:"description",component:e.jsx(U,{allowClear:!0})},{label:"创建时间",name:"startTime",component:e.jsx(ee,{allowClear:!0,style:{width:"200px"}})},{label:"更新时间",name:"endTime",component:e.jsx(ee,{allowClear:!0,style:{width:"200px"}})}],{SearchFormComponent:i}=qe({getDataRequestFn:t=>l(t),onNewRecordFn:()=>{E(!1),c(!0)},formItems:X,operateComponent:!!S.length&&e.jsx(p,{permission:d.permissionDicMap.EXPORT_ROLE,children:e.jsx(J,{type:"primary",icon:e.jsx(He,{}),onClick:()=>_e(S),children:"导出"})}),formName:"roleSearchUserForm"}),l=t=>{I(!0),Ae({limit:o,offset:(x-1)*o,...t}).then(s=>{K(s.data.list),L(s.data.total)}).finally(()=>{I(!1)})},oe=t=>{ie.confirm({title:"确认删除",content:"确定要删除该角色吗？",okText:"确定",cancelText:"取消",onOk:()=>{Ye(t).then(()=>l())}})},ce=async t=>{R(t),E(!0),c(!0)},de=()=>{f.validateFields().then(t=>{u?$({...a,...t}).then(()=>{c(!1),l()}):Oe(t).then(()=>{c(!1),l()})})},[me,ue]=n.useState([]),pe=async t=>{const s=await Fe(),r=await Qe(),_=Ve(s.data),Me=Xe(r.data);ue(Ge(r.data)),B(Me),v(_);const Pe=Je(s.data);m(t.pageID?.filter(be=>Pe.includes(be))||[]),T(t.interfaceID||[]),R(t),j(!0)},[fe,xe]=n.useState(!1),he=(t,s)=>{xe(!0),m([...t,...s.halfCheckedKeys])},Re=t=>{T(t)},ge=()=>{$({...a,pageID:fe?k:a?.pageID,interfaceID:D.filter(t=>!me.includes(t))}).then(()=>{j(!1),l()})},[je,ye]=n.useState([]),[Ue,Ce]=n.useState(0),[y,Q]=n.useState(10),[P,W]=n.useState(1),Ie=async t=>{R(t),W(1),Q(10),await b(t,1,10),M(!0)},b=async(t,s,r)=>{const _=await Ne({roleID:t.id,limit:r,offset:(s-1)*r});ye(_.data.list),Ce(_.data.total)},Z=async t=>{a?.id&&(await Le({userID:t.id,roleID:a.id}),await b(a,P,y),C?.current?.getPageData())},Se=async(t,s)=>{a?.id&&(W(t),Q(s),await b(a,t,s))},ke=async t=>{await we({userID:t.id,roleID:a.id}),await b(a,P,y)},De=[{title:"序号",align:"center",render:(t,s,r)=>(P-1)*y+r+1},{title:"账号",dataIndex:"account",key:"account"},{title:"昵称",dataIndex:"nickname",key:"nickname"},{title:"操作",key:"action",align:"center",render:(t,s)=>e.jsx("div",{className:"gap-2 flex text-red-500 items-center cursor-pointer justify-center",children:e.jsx(p,{permission:d.permissionDicMap.UNBIND_USER,children:e.jsx("span",{onClick:()=>Z(s),children:"移除"})})})}],Te=[{title:"序号",align:"center",render:(t,s,r)=>(P-1)*y+r+1},{title:"账号",dataIndex:"account",key:"account"},{title:"昵称",dataIndex:"nickname",key:"nickname"},{title:"角色",dataIndex:"isAdmin",key:"isAdmin",align:"center",render:(t,{isAdmin:s})=>e.jsx(te,{color:s?"gold":"green",children:s?"系统账号":"普通账号"})},{title:"状态",dataIndex:"status",key:"status",align:"center",render:(t,{status:s})=>e.jsx(te,{color:s?"green":"red",className:"cursor-pointer",children:s==="1"?"启用":"禁用"})},{title:"创建时间",dataIndex:"createTime",key:"createTime",align:"center",render:(t,{createTime:s})=>e.jsx("span",{className:"text-[12px]",children:A(s).format("YYYY-MM-DD HH:mm:ss")})},{title:"更新时间",dataIndex:"updateTime",key:"updateTime",align:"center",render:(t,{updateTime:s})=>e.jsx("span",{className:"text-[12px]",children:A(s).format("YYYY-MM-DD HH:mm:ss")})},{title:"操作",key:"action",align:"center",render:(t,s)=>e.jsx("div",{className:"gap-2 flex text-[#48ade9] items-center cursor-pointer justify-center",children:e.jsx("span",{onClick:()=>Z(s),children:"新增"})})}],Ee=[{title:"序号",align:"center",render:(t,s,r)=>(x-1)*o+r+1},{title:"角色名称",dataIndex:"roleName",key:"roleName"},{title:"角色描述",dataIndex:"description",key:"description"},{title:"创建时间",dataIndex:"createTime",key:"createTime",align:"center",render:(t,{createTime:s})=>e.jsx("span",{className:"text-sm",children:A(s).format("YYYY-MM-DD HH:mm:ss")})},{title:"更新时间",dataIndex:"updateTime",key:"updateTime",align:"center",render:(t,{updateTime:s})=>e.jsx("span",{className:"text-sm",children:A(s).format("YYYY-MM-DD HH:mm:ss")})},{title:"操作",key:"action",align:"center",render:(t,s)=>e.jsxs("div",{className:"gap-2 flex text-[#5bb4ef] items-center cursor-pointer justify-center",children:[e.jsx(p,{permission:[d.permissionDicMap.UPDATE_ROLE],children:e.jsx("span",{onClick:()=>pe(s),children:"权限编辑"})}),e.jsx(p,{permission:[d.permissionDicMap.UPDATE_ROLE],children:e.jsx("span",{onClick:()=>Ie(s),children:"授权用户"})}),e.jsx(p,{permission:d.permissionDicMap.UPDATE_ROLE,children:e.jsx("span",{onClick:()=>ce(s),children:"编辑"})}),e.jsx(p,{permission:d.permissionDicMap.DELETE_ROLE,children:e.jsx("span",{className:"text-red-500",onClick:()=>oe(s.id),children:"删除"})})]})}];return n.useEffect(()=>{g&&u&&f.setFieldsValue(a)},[g]),n.useEffect(()=>{l()},[o,x]),{userPageRef:C,limit:o,roleUnderUserLimit:y,total:N,roleUnderUserListTotal:Ue,roleColumns:Ee,userColumns:De,unSelectedUserColumns:Te,roles:q,SearchFormComponent:i,roleMenusSelected:k,roleInterfaceSelected:D,loading:F,editRoleModalOpen:g,isEdit:u,formRef:f,menus:H,currentEditRole:a,editRolePermissionOpen:z,editRoleUnderUserOpen:V,allInterface:h,roleUnderUsersList:je,addRoleUnderUserAction:ke,onPageTreeCheck:he,onInterfaceTreeCheck:Re,onFinish:de,setEditRoleModalOpen:c,setSelected:Y,setPage:w,setLimit:O,roleUnderUserPageChange:Se,setEditRolePermissionOpen:j,setEditRoleUnderUserOpen:M,editPermissionConfirm:ge}},$e=()=>{const{userPageRef:C,roles:f,roleColumns:o,userColumns:O,menus:x,SearchFormComponent:w,total:N,roleUnderUserListTotal:L,limit:F,roleUnderUserLimit:I,loading:S,isEdit:Y,formRef:k,roleInterfaceSelected:m,currentEditRole:D,editRoleModalOpen:T,editRolePermissionOpen:q,editRoleUnderUserOpen:K,onPageTreeCheck:H,allInterface:v,roleMenusSelected:h,onInterfaceTreeCheck:B,roleUnderUsersList:a,addRoleUnderUserAction:R,setEditRolePermissionOpen:u,setEditRoleUnderUserOpen:E,setPage:g,setLimit:c,roleUnderUserPageChange:z,setSelected:j,setEditRoleModalOpen:V,onFinish:M,editPermissionConfirm:X}=Ze();return e.jsxs(e.Fragment,{children:[w,e.jsx(se,{dataSource:f,rowSelection:{onChange:i=>{j(i)}},loading:S,columns:o,bordered:!0,pagination:!1,rowKey:"id"}),e.jsx(ne,{total:N,className:"flex justify-end mt-2",pageSize:F,onChange:i=>g(i),showSizeChanger:!0,onShowSizeChange:(i,l)=>c(l)}),e.jsx(ie,{open:T,title:Y?"编辑":"新增",onOk:M,onCancel:()=>V(!1),children:e.jsxs(G,{form:k,autoComplete:"off",labelAlign:"left",labelCol:{span:6},id:"editFormRef",children:[e.jsx(G.Item,{name:"roleName",label:"角色名称",rules:[{required:!0}],children:e.jsx(U,{})}),e.jsx(G.Item,{name:"description",label:"角色描述",rules:[{required:!0}],children:e.jsx(U,{})})]})}),e.jsx(ae,{title:"权限编辑",width:"40%",destroyOnClose:!0,onClose:()=>u(!1),open:q,extra:e.jsxs(Be,{children:[e.jsx(J,{onClick:()=>u(!1),children:"取消"}),e.jsx(J,{type:"primary",onClick:X,children:"确认"})]}),children:e.jsx(ve,{size:"small",items:[{label:"菜单权限",key:"1",children:e.jsx(e.Fragment,{children:e.jsx(re,{treeData:x,checkable:!0,defaultExpandedKeys:h,defaultSelectedKeys:h,defaultCheckedKeys:h,multiple:!0,selectable:!1,onCheck:H})})},{label:"资源权限",key:"2",children:e.jsx(e.Fragment,{children:e.jsx(re,{treeData:v,defaultExpandedKeys:m,defaultSelectedKeys:m,defaultCheckedKeys:m,multiple:!0,checkable:!0,selectable:!1,onCheck:B})})}]})}),e.jsx(ae,{open:K,title:"授权用户",width:"80%",destroyOnClose:!0,onClose:()=>E(!1),children:e.jsxs("div",{className:"flex gap-2 justify-between",children:[e.jsxs(le,{title:"已授权用户",style:{width:"50%"},children:[e.jsx(se,{dataSource:a,columns:O,pagination:!1,rowKey:"id",bordered:!0}),e.jsx(ne,{total:L,className:"flex justify-end mt-2",pageSize:I,onChange:(i,l)=>z(i,l),showSizeChanger:!0})]}),e.jsx("div",{className:"my-auto",children:e.jsx(ze,{})}),e.jsx(le,{title:"未授权用户",children:e.jsx(We,{ref:C,module:d.module.ROLE,context:D?.id,operation:R})})]})})]})},mt=n.memo($e);export{mt as default};
