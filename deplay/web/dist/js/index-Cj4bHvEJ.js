import{r,j as t}from"./vendor-react-BvY5jkjb.js";import{A as c}from"./route-login-BWcqE1fc.js";import{u as G}from"./useSearchForm-DVBHnHbJ.js";import{e4 as N}from"./vendor-common-DvYBgWFG.js";import{G as K,l as k,S as f,N as R,O as Q,Q as U,F as i}from"./vendor-antd-VwCNQJi5.js";import"./route-layout-33ldzD5l.js";import"./vendor-redux-D__shqzO.js";import"./vendor-router-C3iwmVt3.js";const V=s=>c.post({url:"/asset/query",data:s}),$=s=>c.post({url:"/asset",data:s}),B=(s,o)=>c.patch({url:`/asset/update/${s}`,data:o}),J=s=>c.delete({url:"/asset/batch-delete",data:s}),T={1:"工装车",2:"牵引车"},Y={1:"正常在库",2:"正常出库",3:"异常待修",4:"维修中",5:"报废",6:"呆滞",7:"疑似丢失"},W=()=>c.get({url:"/sl/store/map"}),X=()=>c.get({url:"/iot/tag/map"}),Z=()=>{const[s]=K(),[o,I]=r.useState(10),[g,j]=r.useState(1),[y,S]=r.useState(0),[A,h]=r.useState(!1),[E,C]=r.useState([]),[b,F]=r.useState([]),[d,q]=r.useState(),[u,x]=r.useState(!1),[m,a]=r.useState(!1),[l,w]=r.useState([]),[O,D]=r.useState([]);r.useEffect(()=>{W().then(e=>{w(e.data)})},[]),r.useEffect(()=>{X().then(e=>{D(e.data)})},[]);const P=[{label:"资产编码",name:"assetCode",component:t.jsx(k,{placeholder:"请输入资产编码",allowClear:!0})},{label:"场库",name:"storeId",component:t.jsx(f,{placeholder:"请选择场库",allowClear:!0,children:l.map(e=>t.jsx(f.Option,{value:e.storeId,children:e.storeName},e.storeId))})}],{SearchFormComponent:H}=G({getDataRequestFn:e=>p(e),onNewRecordFn:()=>{x(!1),s.resetFields(),a(!0)},formItems:P,formName:"roleSearchUserForm"}),p=e=>{h(!0),V({limit:o,offset:(g-1)*o,...e}).then(n=>{F(n.data.list),S(n.data.total)}).finally(()=>{h(!1)})},v=e=>{R.confirm({title:"确认删除",content:"确定要删除该资产吗？",okText:"确定",cancelText:"取消",onOk:()=>{J([e]).then(()=>p())}})},z=async e=>{q(e),x(!0),a(!0)},L=()=>{s.validateFields().then(e=>{const n={...e,quantity:Number(e.quantity),tagId:Number(e.tagId)};u&&d?B(d.assetId,{...d,...n}).then(()=>{a(!1),s.resetFields(),p()}):$(n).then(()=>{a(!1),s.resetFields(),p()})})},_=[{title:"资产ID",dataIndex:"assetId",key:"assetId"},{title:"资产编码",dataIndex:"assetCode",key:"assetCode"},{title:"资产类型",dataIndex:"assetType",key:"assetType",render:e=>T[e]||"-"},{title:"资产状态",dataIndex:"status",key:"status",render:e=>Y[e]||"-"},{title:"数量",dataIndex:"quantity",key:"quantity"},{title:"标签编码",dataIndex:"tagId",key:"tagCode",render:e=>O.find(M=>Number(M.id)===e)?.tagCode||"未设置"},{title:"场库名称",dataIndex:"storeId",key:"storeName",render:e=>l.find(M=>M.storeId===e)?.storeName||"未设置"},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",render:e=>N(e).format("YYYY-MM-DD HH:mm:ss")},{title:"更新时间",dataIndex:"updatedAt",key:"updatedAt",render:e=>N(e).format("YYYY-MM-DD HH:mm:ss")},{title:"操作",key:"action",align:"center",render:(e,n)=>t.jsxs("div",{className:"gap-2 flex text-[#5bb4ef] items-center cursor-pointer justify-center",children:[t.jsx("span",{onClick:()=>z(n),children:"编辑"}),t.jsx("span",{className:"text-red-500",onClick:()=>v(n.assetId),children:"删除"})]})}];return r.useEffect(()=>{m&&u&&s.setFieldsValue(d)},[m]),r.useEffect(()=>{p()},[o,g]),{list:b,roleColumns:_,SearchFormComponent:H,total:y,limit:o,loading:A,isEdit:u,formRef:s,editAssetModalOpen:m,setPage:j,setLimit:I,setSelected:C,setEditAssetModalOpen:e=>{a(e),e||s.resetFields()},onFinish:L,tagMap:O}},ee=()=>{const{list:s,roleColumns:o,SearchFormComponent:I,total:g,limit:j,loading:y,isEdit:S,formRef:A,editAssetModalOpen:h,setPage:E,setLimit:C,setSelected:b,setEditAssetModalOpen:F,onFinish:d,tagMap:q}=Z(),u=Object.entries(T).map(([a,l])=>({label:l,value:parseInt(a,10)})),x=Object.entries(Y).map(([a,l])=>({label:l,value:parseInt(a,10)})),m=q.map(a=>({label:a.tagCode,value:a.id}));return t.jsxs(t.Fragment,{children:[I,t.jsx(Q,{dataSource:s,rowSelection:{onChange:a=>{b(a)}},loading:y,columns:o,bordered:!0,pagination:!1,rowKey:"assetId"}),t.jsx(U,{total:g,className:"flex justify-end mt-2",pageSize:j,onChange:a=>E(a),showSizeChanger:!0,onShowSizeChange:(a,l)=>C(l)}),t.jsx(R,{open:h,title:S?"编辑":"新增",onOk:d,onCancel:()=>F(!1),children:t.jsxs(i,{form:A,autoComplete:"off",labelAlign:"left",id:"editFormRef",children:[t.jsx(i.Item,{name:"assetCode",label:"资产编码",rules:[{required:!0,message:"请输入资产编码"}],children:t.jsx(k,{placeholder:"请输入资产编码"})}),t.jsx(i.Item,{name:"assetType",label:"资产类型",rules:[{required:!0,message:"请选择资产类型"}],children:t.jsx(f,{placeholder:"请选择资产类型",options:u})}),t.jsx(i.Item,{name:"status",label:"资产状态",rules:[{required:!0,message:"请选择资产状态"}],children:t.jsx(f,{placeholder:"请选择资产状态",options:x})}),t.jsx(i.Item,{name:"quantity",label:"数量",rules:[{required:!0,message:"请输入数量"}],children:t.jsx(k,{type:"number",placeholder:"请输入数量"})}),t.jsx(i.Item,{name:"tagId",label:"标签",rules:[{required:!0,message:"请选择标签"}],children:t.jsx(f,{placeholder:"请选择标签",options:m})})]})})]})},ie=r.memo(ee);export{ie as default};
