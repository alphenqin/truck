import{r as o,j as e}from"./vendor-react-BvY5jkjb.js";import{e4 as p}from"./vendor-common-DvYBgWFG.js";import{A as f}from"./route-login-BWcqE1fc.js";import{F as r,s as P,l as g,J as C,o as x,a4 as j,O as q,V as v}from"./vendor-antd-VwCNQJi5.js";import"./route-layout-33ldzD5l.js";import"./vendor-redux-D__shqzO.js";import"./vendor-router-C3iwmVt3.js";const A=n=>f.post({url:"/monitor/track",data:n}),z=n=>f.post({url:"/monitor/location",data:n}),{RangePicker:N}=C,Q=()=>{const[n]=r.useForm(),[d]=r.useForm(),[a,y]=P.useMessage(),[m,u]=o.useState(!1),[D,I]=o.useState(!1),[Y,T]=o.useState([]),[k,S]=o.useState(0),[h,F]=o.useState(1),[c,w]=o.useState(10),[i,M]=o.useState(null),b=async()=>{const t=n.getFieldsValue();if(!t.assetId){a.error("请输入资产ID");return}if(!t.timeRange){a.error("请选择时间范围");return}u(!0);try{const s={assetId:parseInt(t.assetId,10),startTime:t.timeRange[0].format("YYYY-MM-DD HH:mm:ss"),endTime:t.timeRange[1].format("YYYY-MM-DD HH:mm:ss"),limit:c,offset:(h-1)*c},l=await A(s);l?.code===200?(T(l.data.list),S(l.data.total)):a.error("获取资产轨迹失败")}catch(s){console.error("查询失败:",s),a.error("查询失败")}finally{u(!1)}},H=async()=>{const t=d.getFieldsValue();if(!t.assetId){a.error("请输入资产ID");return}I(!0);try{const s=await z({assetId:parseInt(t.assetId,10)});s?.code===200?M(s.data):a.error("获取资产位置失败")}catch(s){console.error("查询失败:",s),a.error("查询失败")}finally{I(!1)}},L=[{title:"监控记录ID",dataIndex:"monitorId",key:"monitorId"},{title:"资产ID",dataIndex:"assetId",key:"assetId"},{title:"网关ID",dataIndex:"gatewayId",key:"gatewayId"},{title:"检测时间",dataIndex:"detectionTime",key:"detectionTime",render:t=>t?p(t).format("YYYY-MM-DD HH:mm:ss"):"-"}],R=[{key:"1",label:"轨迹回放",children:e.jsxs(e.Fragment,{children:[e.jsxs(r,{form:n,onFinish:b,layout:"inline",children:[e.jsx(r.Item,{name:"assetId",label:"资产ID",rules:[{required:!0,message:"请输入资产ID"},{pattern:/^[1-9]\d*$/,message:"资产ID必须为正整数"}],children:e.jsx(g,{placeholder:"请输入资产ID"})}),e.jsx(r.Item,{name:"timeRange",label:"时间范围",rules:[{required:!0}],children:e.jsx(N,{showTime:!0})}),e.jsx(r.Item,{children:e.jsx(x,{type:"primary",htmlType:"submit",loading:m,icon:e.jsx(j,{}),children:"查询"})})]}),e.jsx(q,{columns:L,dataSource:Y,rowKey:"monitorId",loading:m,className:"mt-4",pagination:{current:h,pageSize:c,total:k,showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>`共 ${t} 条记录`,onChange:(t,s)=>{F(t),w(s||10)}}})]})},{key:"2",label:"实时定位",children:e.jsxs(e.Fragment,{children:[e.jsxs(r,{form:d,onFinish:H,layout:"inline",children:[e.jsx(r.Item,{name:"assetId",label:"资产ID",rules:[{required:!0,message:"请输入资产ID"},{pattern:/^[1-9]\d*$/,message:"资产ID必须为正整数"}],children:e.jsx(g,{placeholder:"请输入资产ID"})}),e.jsx(r.Item,{children:e.jsx(x,{type:"primary",htmlType:"submit",loading:D,icon:e.jsx(j,{}),children:"查询"})})]}),i&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{children:"当前位置信息"}),e.jsxs("p",{children:["资产ID: ",i.assetId]}),e.jsxs("p",{children:["网关ID: ",i.gatewayId]}),e.jsxs("p",{children:["最后检测时间: ",p(i.detectionTime).format("YYYY-MM-DD HH:mm:ss")]})]})]})}];return e.jsxs("div",{className:"p-6",children:[y,e.jsx(v,{items:R})]})};export{Q as default};
