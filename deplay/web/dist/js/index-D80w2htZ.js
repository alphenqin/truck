import{l as c,j as e,h9 as N,gU as L,r as a,V as g,hj as H,S as p,h8 as Y,ha as z,Q as te,Y as se,h7 as ae,hb as ne,hc as re}from"./vendor-core-BL9Phd6R.js";import{l as oe,m as le,n as V,o as ie,p as ce,c as de,q as ue,r as me,s as pe}from"./route-login-r9SQJoz-.js";import{a as d}from"./route-layout-BrOgEPTf.js";import{A as E}from"./index-OYfbAcuj.js";import{u as he}from"./useSearchForm-DGLxIQDe.js";const xe=(x,r)=>{const[D]=c.useForm(),[u]=c.useForm(),I=[{title:"序号",align:"center",hidden:r?.module===d.module.ROLE,render:(s,t,m)=>(h-1)*o+m+1},{title:"账号",dataIndex:"account",key:"account"},{title:"昵称",dataIndex:"nickname",key:"nickname"},{title:"角色",dataIndex:"isAdmin",key:"isAdmin",align:"center",render:(s,{isAdmin:t})=>e.jsx(N,{color:t?"gold":"green",children:t?"系统账号":"普通账号"})},{title:"状态",dataIndex:"status",hidden:r?.module===d.module.ROLE,key:"status",align:"center",render:(s,{status:t,id:m})=>e.jsx(N,{color:t==="1"?"green":"red",className:"cursor-pointer",onClick:()=>W({id:m,status:t==="1"?"0":"1"}),children:t==="1"?"启用":"禁用"})},{title:"创建时间",dataIndex:"createTime",key:"createTime",align:"center",render:(s,{createTime:t})=>e.jsx("span",{children:L(t).format("YYYY-MM-DD HH:mm:ss")})},{title:"更新时间",dataIndex:"updateTime",key:"updateTime",align:"center",render:(s,{updateTime:t})=>e.jsx("span",{children:L(t).format("YYYY-MM-DD HH:mm:ss")})},{title:"操作",key:"action",align:"center",render:(s,t)=>r?.module!==d.module.ROLE?e.jsxs("div",{className:"gap-2 flex text-[#5bb4ef] items-center cursor-pointer justify-center",children:[e.jsx(E,{permission:d.permissionDicMap.UPDATE_USER,children:e.jsx("span",{onClick:()=>v(t.id),children:"编辑"})}),e.jsx(E,{permission:d.permissionDicMap.DELETE_USER,children:e.jsx("span",{className:"text-red-500",onClick:()=>Z(t.id),children:"删除"})})]}):e.jsx("div",{className:"gap-2 flex text-[#5bb4ef] items-center cursor-pointer justify-center",children:e.jsx(E,{permission:d.permissionDicMap.BIND_USER,children:e.jsx("span",{onClick:()=>r?.operation&&r?.operation(t).then(()=>{i()}),children:"授权"})})})}],[R,k]=a.useState([]),[o,y]=a.useState(10),[h,l]=a.useState(1),[F,U]=a.useState(!1),[S,b]=a.useState([]),[q,O]=a.useState([]),[T,M]=a.useState(0),[A,_]=a.useState([]),[f,j]=a.useState(!1),[w,n]=a.useState(),[C,B]=a.useState(!0),K=[{label:"账号",name:"account",component:e.jsx(g,{allowClear:!0})},{label:"昵称",name:"nickname",component:e.jsx(g,{allowClear:!0})},{label:"部门",name:"departmentID",component:e.jsx(H,{allowClear:!0,treeData:R})},{label:"状态",name:"status",component:e.jsxs(p,{allowClear:!0,children:[e.jsx(p.Option,{value:"1",children:"开启"}),e.jsx(p.Option,{value:"0",children:"禁用"})]})},{label:"创建时间",name:"startTime",component:e.jsx(Y,{allowClear:!0,style:{width:"100%"}})},{label:"更新时间",name:"endTime",component:e.jsx(Y,{allowClear:!0,style:{width:"100%"}})}],Q=s=>i(s),X={id:"",account:"",nickname:"",password:"",departmentID:"",rolesID:[],status:"1"},G=()=>{D?.resetFields(),i()},i=s=>{U(!0),(r?.module===d.module.ROLE?()=>oe({limit:o,offset:(h-1)*o,...s},r?.context):()=>le({limit:o,offset:(h-1)*o,...s}))().then(m=>{O(m.data.list),M(m.data.total)}).finally(()=>{U(!1)})},J=()=>{ue().then(s=>{k(P(s.data))})};function P(s){return s?.map(t=>({title:t.departmentName,key:t.id,value:t.id,children:t.children&&P(t.children)||[]}))||[]}const W=s=>{V(s).then(()=>i())},Z=s=>{z.confirm({title:"确认删除",content:"确定要删除该用户吗？",okText:"确定",cancelText:"取消",onOk:()=>{ie(s).then(()=>i())}})},$=async()=>{await pe(S)},v=async s=>{const{data:t}=s?await ce(s):{data:X},{data:m}=await de();B(!!s),_(m.list),n(t),j(!0)};a.useEffect(()=>{f&&u.setFieldsValue(w)},[f]);const ee=async()=>{if(!await u.validateFields())return;const t={...u.getFieldsValue(),id:w?.id};u.getFieldsValue().password&&(t.password=te.hashStr(u.getFieldsValue().password)),C?await V(t):await me(t),j(!1),i()};return a.useEffect(()=>{i()},[h,o]),a.useEffect(()=>{J()},[]),a.useImperativeHandle(x,()=>({getPageData:i})),{userPageRef:x,total:T,users:q,roles:A,departments:R,columns:I,editFormRef:u,editUserModalOpen:f,isEdit:C,limit:o,page:h,selected:S,searchConfig:K,loading:F,exportUsersAction:$,setSelected:b,getPageData:i,setLimit:y,setPage:l,onFinish:Q,onReset:G,editUserConfirm:ee,setEditUserModalOpen:j,editUserAction:v}},fe=(x,r)=>{const{userPageRef:D,total:u,columns:I,departments:R,users:k,editFormRef:o,editUserModalOpen:y,roles:h,isEdit:l,limit:F,searchConfig:U,selected:S,loading:b,exportUsersAction:q,setSelected:O,getPageData:T,setPage:M,setLimit:A,editUserConfirm:_,setEditUserModalOpen:f,editUserAction:j}=xe(r,x),{SearchFormComponent:w}=he({getDataRequestFn:T,onNewRecordFn:j,formItems:U,operateComponent:!!S.length&&e.jsx(E,{permission:d.permissionDicMap.EXPORT_USER,children:e.jsx(se,{type:"primary",icon:e.jsx(ae,{}),onClick:q,children:"导出"})}),formName:"userSearchForm",showAddBtn:x?.module!==d.module.ROLE});return e.jsxs("div",{ref:D,children:[w,e.jsx(ne,{dataSource:k,loading:b,columns:I,rowSelection:{onChange:n=>{O(n)}},bordered:!0,pagination:!1,rowKey:"id"}),e.jsx(re,{total:u,className:"flex justify-end mt-2",pageSize:F,onChange:n=>M(n),showSizeChanger:!0,onShowSizeChange:(n,C)=>A(C)}),e.jsx(z,{destroyOnClose:!0,open:y,title:l?"编辑":"新增",onOk:_,onCancel:()=>f(!1),children:e.jsxs(c,{form:o,autoComplete:"off",labelAlign:"left",labelCol:{span:6},id:"editFormRef",children:[!l&&e.jsx(c.Item,{name:"account",label:"账号",rules:[{required:!l}],children:e.jsx(g,{})}),e.jsx(c.Item,{name:"nickname",label:"昵称",rules:[{required:!0}],children:e.jsx(g,{})}),e.jsx(c.Item,{name:"password",label:"密码",rules:[{required:!l}],children:e.jsx(g.Password,{})}),e.jsx(c.Item,{name:"departmentID",label:"部门",rules:[{required:!l}],children:e.jsx(H,{allowClear:!0,treeData:R})}),e.jsx(c.Item,{name:"rolesID",label:"角色",rules:[{required:!l}],children:e.jsx(p,{allowClear:!0,mode:"multiple",children:h?.map(n=>e.jsx(p.Option,{value:n.id,children:n.roleName},n.id))})}),e.jsx(c.Item,{name:"status",label:"状态",rules:[{required:!l}],children:e.jsxs(p,{children:[e.jsx(p.Option,{value:"0",children:"禁用"}),e.jsx(p.Option,{value:"1",children:"启用"})]})})]})})]})},we=a.memo(a.forwardRef(fe));export{we as default};
