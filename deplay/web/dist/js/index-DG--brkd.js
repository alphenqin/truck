import{r as s,j as e}from"./vendor-react-BvY5jkjb.js";import{A as m}from"./route-login-BWcqE1fc.js";import{u as K}from"./useSearchForm-DVBHnHbJ.js";import"./vendor-common-DvYBgWFG.js";import{G as M,o as T,H as A,l,N as R,O as z,Q as D,F as h}from"./vendor-antd-VwCNQJi5.js";import"./route-layout-33ldzD5l.js";import"./vendor-redux-D__shqzO.js";import"./vendor-router-C3iwmVt3.js";const L=t=>m.post({url:"/base/notice/query",data:t}),H=t=>m.post({url:"/base/notice",data:t}),_=(t,a)=>m.patch({url:`/base/notice/update/${t}`,data:a}),v=t=>m.delete({url:"/base/notice/batch-delete",data:t}),B=t=>m.post({url:"/base/notice/export",data:{ids:t},responseType:"blob"}),G=()=>{const[t]=M(),[a,N]=s.useState(10),[p,g]=s.useState(1),[j,b]=s.useState(0),[S,f]=s.useState(!1),[x,C]=s.useState([]),[y,F]=s.useState([]),[r,i]=s.useState(),[c,I]=s.useState(!1),[k,u]=s.useState(!1),q=[{label:"规则名称",name:"ruleName",component:e.jsx(l,{allowClear:!0})},{label:"规则键",name:"ruleKey",component:e.jsx(l,{allowClear:!0})},{label:"规则值",name:"ruleValue",component:e.jsx(l,{allowClear:!0})}],{SearchFormComponent:E}=K({getDataRequestFn:o=>d(o),onNewRecordFn:()=>{t.resetFields(),I(!1),u(!0)},formItems:q,operateComponent:!!x.length&&e.jsx(T,{type:"primary",icon:e.jsx(A,{}),onClick:()=>B(x.map(Number)),children:"导出"}),formName:"noticeSearchForm"}),d=o=>{f(!0),L({limit:a,offset:(p-1)*a,...o}).then(n=>{F(n.data.list),b(n.data.total)}).finally(()=>{f(!1)})},w=o=>{R.confirm({title:"确认删除",content:"确定要删除该规则吗？",okText:"确认",cancelText:"取消",onOk:()=>{v([o]).then(()=>d())}})},O=async o=>{i(o),I(!0),u(!0)},P=()=>{t.validateFields().then(o=>{if(c&&r){const n={...o,id:r.id};_(r.id,n).then(()=>{u(!1),d()})}else H(o).then(()=>{u(!1),d()})})},V=[{title:"ID",dataIndex:"id",key:"id"},{title:"规则名称",dataIndex:"ruleName",key:"ruleName"},{title:"规则键",dataIndex:"ruleKey",key:"ruleKey"},{title:"规则值",dataIndex:"ruleValue",key:"ruleValue"},{title:"操作",key:"action",align:"center",render:(o,n)=>e.jsxs("div",{className:"gap-2 flex text-[#5bb4ef] items-center cursor-pointer justify-center",children:[e.jsx("span",{onClick:()=>O(n),children:"编辑"}),e.jsx("span",{className:"text-red-500",onClick:()=>w(n.id),children:"删除"})]})}];return s.useEffect(()=>{k&&c&&t.setFieldsValue(r)},[k]),s.useEffect(()=>{d()},[a,p]),{list:y,noticeColumns:V,SearchFormComponent:E,total:j,limit:a,loading:S,isEdit:c,formRef:t,editNoticeModalOpen:k,setPage:g,setLimit:N,setSelected:C,setEditNoticeModalOpen:u,onFinish:P}},Q=()=>{const{list:t,noticeColumns:a,SearchFormComponent:N,total:p,limit:g,loading:j,isEdit:b,formRef:S,editNoticeModalOpen:f,setPage:x,setLimit:C,setSelected:y,setEditNoticeModalOpen:F,onFinish:r}=G();return e.jsxs(e.Fragment,{children:[N,e.jsx(z,{dataSource:t,rowSelection:{onChange:i=>{y(i)}},loading:j,columns:a,bordered:!0,pagination:!1,rowKey:"id"}),e.jsx(D,{total:p,className:"flex justify-end mt-2",pageSize:g,onChange:i=>x(i),showSizeChanger:!0,onShowSizeChange:(i,c)=>C(c)}),e.jsx(R,{open:f,title:b?"编辑":"新增",onOk:r,onCancel:()=>F(!1),children:e.jsxs(h,{form:S,autoComplete:"off",labelAlign:"left",id:"editFormRef",children:[e.jsx(h.Item,{name:"ruleName",label:"规则名称",rules:[{required:!0}],children:e.jsx(l,{})}),e.jsx(h.Item,{name:"ruleKey",label:"规则键",rules:[{required:!0}],children:e.jsx(l,{})}),e.jsx(h.Item,{name:"ruleValue",label:"规则值",rules:[{required:!0}],children:e.jsx(l,{})})]})})]})},te=s.memo(Q);export{te as default};
