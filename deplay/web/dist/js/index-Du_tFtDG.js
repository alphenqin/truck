import{l as a,Z as P,r as o,j as e,V as g,h8 as C,Y as p,hp as x,hb as q,gU as j,he as v}from"./vendor-core-BL9Phd6R.js";import{A as y}from"./route-login-p179xrQD.js";import"./route-layout-De7MC9tK.js";const A=n=>y.post({url:"/monitor/track",data:n}),z=n=>y.post({url:"/monitor/location",data:n}),{RangePicker:N}=C,B=()=>{const[n]=a.useForm(),[d]=a.useForm(),[r,D]=P.useMessage(),[m,u]=o.useState(!1),[f,I]=o.useState(!1),[Y,T]=o.useState([]),[k,S]=o.useState(0),[h,w]=o.useState(1),[c,F]=o.useState(10),[i,M]=o.useState(null),b=async()=>{const t=n.getFieldsValue();if(!t.assetId){r.error("请输入资产ID");return}if(!t.timeRange){r.error("请选择时间范围");return}u(!0);try{const s={assetId:parseInt(t.assetId,10),startTime:t.timeRange[0].format("YYYY-MM-DD HH:mm:ss"),endTime:t.timeRange[1].format("YYYY-MM-DD HH:mm:ss"),limit:c,offset:(h-1)*c},l=await A(s);l?.code===200?(T(l.data.list),S(l.data.total)):r.error("获取资产轨迹失败")}catch(s){console.error("查询失败:",s),r.error("查询失败")}finally{u(!1)}},H=async()=>{const t=d.getFieldsValue();if(!t.assetId){r.error("请输入资产ID");return}I(!0);try{const s=await z({assetId:parseInt(t.assetId,10)});s?.code===200?M(s.data):r.error("获取资产位置失败")}catch(s){console.error("查询失败:",s),r.error("查询失败")}finally{I(!1)}},L=[{title:"监控记录ID",dataIndex:"monitorId",key:"monitorId"},{title:"资产ID",dataIndex:"assetId",key:"assetId"},{title:"网关ID",dataIndex:"gatewayId",key:"gatewayId"},{title:"检测时间",dataIndex:"detectionTime",key:"detectionTime",render:t=>t?j(t).format("YYYY-MM-DD HH:mm:ss"):"-"}],R=[{key:"1",label:"轨迹回放",children:e.jsxs(e.Fragment,{children:[e.jsxs(a,{form:n,onFinish:b,layout:"inline",children:[e.jsx(a.Item,{name:"assetId",label:"资产ID",rules:[{required:!0,message:"请输入资产ID"},{pattern:/^[1-9]\d*$/,message:"资产ID必须为正整数"}],children:e.jsx(g,{placeholder:"请输入资产ID"})}),e.jsx(a.Item,{name:"timeRange",label:"时间范围",rules:[{required:!0}],children:e.jsx(N,{showTime:!0})}),e.jsx(a.Item,{children:e.jsx(p,{type:"primary",htmlType:"submit",loading:m,icon:e.jsx(x,{}),children:"查询"})})]}),e.jsx(q,{columns:L,dataSource:Y,rowKey:"monitorId",loading:m,className:"mt-4",pagination:{current:h,pageSize:c,total:k,showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>`共 ${t} 条记录`,onChange:(t,s)=>{w(t),F(s||10)}}})]})},{key:"2",label:"实时定位",children:e.jsxs(e.Fragment,{children:[e.jsxs(a,{form:d,onFinish:H,layout:"inline",children:[e.jsx(a.Item,{name:"assetId",label:"资产ID",rules:[{required:!0,message:"请输入资产ID"},{pattern:/^[1-9]\d*$/,message:"资产ID必须为正整数"}],children:e.jsx(g,{placeholder:"请输入资产ID"})}),e.jsx(a.Item,{children:e.jsx(p,{type:"primary",htmlType:"submit",loading:f,icon:e.jsx(x,{}),children:"查询"})})]}),i&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{children:"当前位置信息"}),e.jsxs("p",{children:["资产ID: ",i.assetId]}),e.jsxs("p",{children:["网关ID: ",i.gatewayId]}),e.jsxs("p",{children:["最后检测时间: ",j(i.detectionTime).format("YYYY-MM-DD HH:mm:ss")]})]})]})}];return e.jsxs("div",{className:"p-6",children:[D,e.jsx(v,{items:R})]})};export{B as default};
