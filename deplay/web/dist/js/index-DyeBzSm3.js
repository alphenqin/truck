import{h6 as T,r as a,j as t,Y as A,h7 as z,V as c,ha as k,hb as L,hc as V,l as y}from"./vendor-core-BL9Phd6R.js";import{A as p}from"./route-login-p179xrQD.js";import{u as _}from"./useSearchForm-DGLxIQDe.js";import"./route-layout-De7MC9tK.js";const B=e=>p.post({url:"/base/department/query",data:e}),H=e=>p.post({url:"/base/department",data:e}),K=(e,n)=>p.patch({url:"/base/department/update",data:{...n,departmentId:e}}),Y=e=>p.delete({url:"/base/department/batch-delete",data:e}),v=e=>p.post({url:"/base/department/export",data:{ids:e},responseType:"blob"}),G=()=>{const[e]=T(),[n,x]=a.useState(10),[u,I]=a.useState(1),[g,b]=a.useState(0),[D,f]=a.useState(!1),[h,j]=a.useState([]),[S,C]=a.useState([]),[r,o]=a.useState(),[l,N]=a.useState(!1),[F,m]=a.useState(!1),E=[{label:"部门ID",name:"departmentId",component:t.jsx(c,{allowClear:!0,type:"number",min:0})},{label:"部门名称",name:"departmentName",component:t.jsx(c,{allowClear:!0})},{label:"场库ID",name:"storeId",component:t.jsx(c,{allowClear:!0,type:"number",min:0})}],{SearchFormComponent:q}=_({getDataRequestFn:s=>i(s),onNewRecordFn:()=>{N(!1),o(void 0),e.resetFields(),m(!0)},formItems:E,operateComponent:!!h.length&&t.jsx(A,{type:"primary",icon:t.jsx(z,{}),onClick:()=>v(h.map(s=>Number(s))),children:"导出"}),formName:"departmentSearchForm"}),i=s=>{f(!0);const d={...s,departmentId:s?.departmentId?Number(s.departmentId):void 0,storeId:s?.storeId?Number(s.storeId):void 0};B({limit:n,offset:(u-1)*n,...d}).then(R=>{C(R.data.list),b(R.data.total)}).finally(()=>{f(!1)})},w=s=>{k.confirm({title:"确认删除",content:"确定要删除这个部门吗？",okText:"确认",cancelText:"取消",onOk:()=>{Y([s]).then(()=>i())}})},O=async s=>{o(s),N(!0),e.resetFields(),m(!0)},P=()=>{e.validateFields().then(s=>{const d={...s,storeId:Number(s.storeId)};l&&r?K(r.departmentId,d).then(()=>{m(!1),e.resetFields(),i()}):H(d).then(()=>{m(!1),e.resetFields(),i()})})},M=[{title:"部门ID",dataIndex:"departmentId",key:"departmentId"},{title:"部门名称",dataIndex:"departmentName",key:"departmentName"},{title:"场库ID",dataIndex:"storeId",key:"storeId"},{title:"操作",key:"action",align:"center",render:(s,d)=>t.jsxs("div",{className:"gap-2 flex text-[#5bb4ef] items-center cursor-pointer justify-center",children:[t.jsx("span",{onClick:()=>O(d),children:"编辑"}),t.jsx("span",{className:"text-red-500",onClick:()=>w(d.departmentId),children:"删除"})]})}];return a.useEffect(()=>{F&&l&&r&&e.setFieldsValue(r)},[F,l,r]),a.useEffect(()=>{i()},[n,u]),{list:S,roleColumns:M,SearchFormComponent:q,total:g,limit:n,loading:D,isEdit:l,formRef:e,editDepartmentsModalOpen:F,setPage:I,setLimit:x,setSelected:j,setEditDepartmentsModalOpen:m,onFinish:P}},J=()=>{const{list:e,roleColumns:n,SearchFormComponent:x,total:u,limit:I,loading:g,isEdit:b,formRef:D,editDepartmentsModalOpen:f,setPage:h,setLimit:j,setSelected:S,setEditDepartmentsModalOpen:C,onFinish:r}=G();return t.jsxs(t.Fragment,{children:[x,t.jsx(L,{dataSource:e,rowSelection:{onChange:o=>{S(o)}},loading:g,columns:n,bordered:!0,pagination:!1,rowKey:"departmentId"}),t.jsx(V,{total:u,className:"flex justify-end mt-2",pageSize:I,onChange:o=>h(o),showSizeChanger:!0,onShowSizeChange:(o,l)=>j(l)}),t.jsx(k,{open:f,title:b?"编辑部门":"新增部门",onOk:r,onCancel:()=>C(!1),children:t.jsxs(y,{form:D,autoComplete:"off",labelAlign:"left",id:"editFormRef",children:[t.jsx(y.Item,{name:"departmentName",label:"部门名称",rules:[{required:!0,message:"请输入部门名称"}],children:t.jsx(c,{})}),t.jsx(y.Item,{name:"storeId",label:"场库ID",rules:[{required:!0,message:"请输入场库ID"}],children:t.jsx(c,{type:"number"})})]})})]})},Z=a.memo(J);export{Z as default};
