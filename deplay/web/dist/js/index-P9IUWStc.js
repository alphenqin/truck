import{r,j as t}from"./vendor-react-BvY5jkjb.js";import{eb as Y}from"./vendor-common-DvYBgWFG.js";import{A as g}from"./route-login-BWcqE1fc.js";import{u as A}from"./useSearchForm-DVBHnHbJ.js";import{G as V,o as z,H as L,l as p,N as k,O as _,Q as B,F as m,S as G}from"./vendor-antd-VwCNQJi5.js";import"./route-layout-33ldzD5l.js";import"./vendor-redux-D__shqzO.js";import"./vendor-router-C3iwmVt3.js";const K=a=>g.post({url:"/iot/tag/query",data:a}),Q=a=>g.post({url:"/iot/tag",data:a}),W=(a,n)=>g.patch({url:`/iot/tag/update/${a}`,data:n}),$=a=>g.delete({url:"/iot/tag/batch-delete",data:a}),J=a=>g.post({url:"/iot/tag/export",data:{ids:a},responseType:"blob"}),U=()=>{const[a]=V(),[n,j]=r.useState(10),[T,C]=r.useState(1),[S,b]=r.useState(0),[y,h]=r.useState(!1),[x,M]=r.useState([]),[I,D]=r.useState([]),[d,l]=r.useState(),[o,H]=r.useState(!1),[F,c]=r.useState(!1),q=[{label:"标签编码",name:"tagCode",component:t.jsx(p,{allowClear:!0})}],{SearchFormComponent:E}=A({getDataRequestFn:e=>{const s={...e};f(s)},onNewRecordFn:()=>{a.resetFields(),H(!1),c(!0)},formItems:q,operateComponent:!!x.length&&t.jsx(z,{type:"primary",icon:t.jsx(L,{}),onClick:()=>J(x.map(String)),children:"导出"}),formName:"rfidTagSearchForm"}),f=e=>{h(!0);const s={limit:n,offset:(T-1)*n};e&&e.tagCode&&(s.tagCode=e.tagCode),K(s).then(u=>{const i=u.data.list.map(R=>({...R,id:R.id,reportTime:R.reportTime?R.reportTime:void 0}));D(i),b(u.data.total)}).finally(()=>{h(!1)})},P=e=>{k.confirm({title:"确认删除",content:"确定要删除该标签吗？",okText:"确认",cancelText:"取消",onOk:()=>{$([e]).then(()=>f())}})},N=async e=>{l(e),H(!0),c(!0)},w=()=>{a.validateFields().then(e=>{const s={tagCode:e.tagCode,electricity:e.electricity};if(typeof e.status=="number"&&(e.status===1||e.status===2))s.status=e.status;else if(typeof e.status=="string"){const i=parseInt(e.status,10);!isNaN(i)&&(i===1||i===2)&&(s.status=i)}e.heartbeat&&(s.heartbeat=e.heartbeat);let u;if(e.reportTime&&typeof e.reportTime=="string"){const i=Y(e.reportTime,"YYYY/MM/DD HH:mm:ss",!0);i.isValid()&&(u=i.format("YYYY-MM-DD HH:mm:ss"))}s.reportTime=u,o&&d?(s.id=d.id,W(d.id,s).then(()=>{c(!1),f()})):Q(s).then(()=>{c(!1),f()})})},O=[{title:"ID",dataIndex:"id",key:"id"},{title:"标签编码",dataIndex:"tagCode",key:"tagCode"},{title:"状态",dataIndex:"status",key:"status",render:e=>e===1?"启用":e===2?"停止":""},{title:"心跳",dataIndex:"heartbeat",key:"heartbeat"},{title:"上报时间",dataIndex:"reportTime",key:"reportTime",render:e=>e?Y(e).format("YYYY/MM/DD HH:mm:ss"):"-"},{title:"操作",key:"action",align:"center",render:(e,s)=>t.jsxs("div",{className:"gap-2 flex text-[#5bb4ef] items-center cursor-pointer justify-center",children:[t.jsx("span",{onClick:()=>N(s),children:"编辑"}),t.jsx("span",{className:"text-red-500",onClick:()=>P(s.id),children:"删除"})]})}];return r.useEffect(()=>{if(F&&o){const e={...d};if(e.reportTime&&typeof e.reportTime=="string"){const s=Y(e.reportTime);s.isValid()?e.reportTime=s.format("YYYY/MM/DD HH:mm:ss"):delete e.reportTime}else(e.reportTime===null||e.reportTime===void 0)&&delete e.reportTime;a.setFieldsValue(e)}},[F,o,d]),r.useEffect(()=>{f()},[n,T]),{list:I,rfidTagColumns:O,SearchFormComponent:E,total:S,limit:n,loading:y,isEdit:o,formRef:a,editRfidTagModalOpen:F,setPage:C,setLimit:j,setSelected:M,setEditRfidTagModalOpen:c,onFinish:w}},X=()=>{const{list:a,rfidTagColumns:n,SearchFormComponent:j,total:T,limit:C,loading:S,isEdit:b,formRef:y,editRfidTagModalOpen:h,setPage:x,setLimit:M,setSelected:I,setEditRfidTagModalOpen:D,onFinish:d}=U();return t.jsxs(t.Fragment,{children:[j,t.jsx(_,{dataSource:a,rowSelection:{onChange:l=>{I(l)}},loading:S,columns:n,bordered:!0,pagination:!1,rowKey:"id"}),t.jsx(B,{total:T,className:"flex justify-end mt-2",pageSize:C,onChange:l=>x(l),showSizeChanger:!0,onShowSizeChange:(l,o)=>M(o)}),t.jsx(k,{open:h,title:b?"编辑":"新增",onOk:d,onCancel:()=>D(!1),children:t.jsxs(m,{form:y,autoComplete:"off",labelAlign:"left",id:"editFormRef",children:[t.jsx(m.Item,{name:"tagCode",label:"标签编码",rules:[{required:!0}],children:t.jsx(p,{})}),t.jsx(m.Item,{name:"status",label:"状态",rules:[{required:!0}],children:t.jsx(G,{options:[{label:"启用",value:1},{label:"停止",value:2}]})}),t.jsx(m.Item,{name:"heartbeat",label:"心跳",children:t.jsx(p,{})}),t.jsx(m.Item,{name:"reportTime",label:"上报时间",rules:[{validator:(l,o)=>o?Y(o,"YYYY/MM/DD HH:mm:ss",!0).isValid()?Promise.resolve():Promise.reject(new Error("格式不正确，应为 YYYY/MM/DD HH:mm:ss")):Promise.resolve()}],children:t.jsx(p,{placeholder:"YYYY/MM/DD HH:mm:ss"})}),t.jsx(m.Item,{name:"electricity",label:"电量",rules:[{required:!0}],children:t.jsx(p,{})})]})})]})},ie=r.memo(X);export{ie as default};
