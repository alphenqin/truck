import{r as o,j as t}from"./vendor-react-BvY5jkjb.js";import{A as y}from"./route-login-BWcqE1fc.js";import{u as z}from"./useSearchForm-DVBHnHbJ.js";import"./vendor-common-DvYBgWFG.js";import{G as D,o as L,H,l as r,S as N,N as R,O as _,Q as B,F as m}from"./vendor-antd-VwCNQJi5.js";import"./route-layout-33ldzD5l.js";import"./vendor-redux-D__shqzO.js";import"./vendor-router-C3iwmVt3.js";const K=a=>y.post({url:"/iot/gateway/query",data:a}),Q=a=>y.post({url:"/iot/gateway",data:a}),W=(a,n)=>y.patch({url:`/iot/gateway/update/${a}`,data:n}),$=a=>y.delete({url:"/iot/gateway/batch-delete",data:a}),J=a=>y.post({url:"/iot/gateway/export",data:{ids:a},responseType:"blob"}),U=()=>{const[a]=D(),[n,f]=o.useState(10),[p,x]=o.useState(1),[C,j]=o.useState(0),[S,g]=o.useState(!1),[w,h]=o.useState([]),[b,F]=o.useState([]),[l,i]=o.useState(),[d,k]=o.useState(!1),[G,u]=o.useState(!1),T=[{label:"网关名称",name:"gatewayName",component:t.jsx(r,{allowClear:!0})},{label:"网关编号",name:"gatewayCode",component:t.jsx(r,{allowClear:!0})},{label:"网关类型",name:"gatewayType",component:t.jsx(r,{allowClear:!0})},{label:"状态",name:"status",component:t.jsx(N,{allowClear:!0,options:[{label:"启用",value:1},{label:"停止",value:2}]})}],{SearchFormComponent:E}=z({getDataRequestFn:e=>{const s={...e};c(s)},onNewRecordFn:()=>{a.resetFields(),k(!1),u(!0)},formItems:T,operateComponent:!!w.length&&t.jsx(L,{type:"primary",icon:t.jsx(H,{}),onClick:()=>J(w.map(String)),children:"导出"}),formName:"gatewaySearchForm"}),c=e=>{g(!0);const s={limit:n,offset:(p-1)*n};e&&(e.id&&(s.id=e.id),e.gatewayName&&(s.gatewayName=e.gatewayName),e.gatewayCode&&(s.gatewayCode=e.gatewayCode),e.gatewayType&&(s.gatewayType=e.gatewayType),e.status!==void 0&&(s.status=e.status)),K(s).then(q=>{const A=q.data.list.map(I=>({...I,id:I.id??I.gatewayId}));F(A),j(q.data.total)}).finally(()=>{g(!1)})},v=e=>{R.confirm({title:"确认删除",content:"确定要删除该网关吗？",okText:"确认",cancelText:"取消",onOk:()=>{$([e]).then(()=>c())}})},O=async e=>{i(e),k(!0),u(!0)},P=()=>{a.validateFields().then(e=>{const s={...e};d&&l?(s.id=l.id,W(l.id,s).then(()=>{u(!1),c()})):Q(s).then(()=>{u(!1),c()})})},M=[{title:"ID",dataIndex:"id",key:"id"},{title:"网关名称",dataIndex:"gatewayName",key:"gatewayName"},{title:"网关编号",dataIndex:"gatewayCode",key:"gatewayCode"},{title:"网关类型",dataIndex:"gatewayType",key:"gatewayType"},{title:"状态",dataIndex:"status",key:"status",render:e=>e===1?"启用":e===2?"停止":""},{title:"操作",key:"action",align:"center",render:(e,s)=>t.jsxs("div",{className:"gap-2 flex text-[#5bb4ef] items-center cursor-pointer justify-center",children:[t.jsx("span",{onClick:()=>O(s),children:"编辑"}),t.jsx("span",{className:"text-red-500",onClick:()=>v(s.id),children:"删除"})]})}];return o.useEffect(()=>{G&&d&&a.setFieldsValue(l)},[G]),o.useEffect(()=>{c()},[n,p]),{list:b,gatewayColumns:M,SearchFormComponent:E,total:C,limit:n,loading:S,isEdit:d,formRef:a,editGatewayModalOpen:G,setPage:x,setLimit:f,setSelected:h,setEditGatewayModalOpen:u,onFinish:P}},X=()=>{const{list:a,gatewayColumns:n,SearchFormComponent:f,total:p,limit:x,loading:C,isEdit:j,formRef:S,editGatewayModalOpen:g,setPage:w,setLimit:h,setSelected:b,setEditGatewayModalOpen:F,onFinish:l}=U();return t.jsxs(t.Fragment,{children:[f,t.jsx(_,{dataSource:a,rowSelection:{onChange:i=>{b(i)}},loading:C,columns:n,bordered:!0,pagination:!1,rowKey:"id"}),t.jsx(B,{total:p,className:"flex justify-end mt-2",pageSize:x,onChange:i=>w(i),showSizeChanger:!0,onShowSizeChange:(i,d)=>h(d)}),t.jsx(R,{open:g,title:j?"编辑":"新增",onOk:l,onCancel:()=>F(!1),children:t.jsxs(m,{form:S,autoComplete:"off",labelAlign:"left",id:"editFormRef",children:[t.jsx(m.Item,{name:"gatewayName",label:"网关名称",rules:[{required:!0}],children:t.jsx(r,{})}),t.jsx(m.Item,{name:"gatewayCode",label:"网关编号",rules:[{required:!0}],children:t.jsx(r,{})}),t.jsx(m.Item,{name:"gatewayType",label:"网关类型",rules:[{required:!0}],children:t.jsx(r,{})}),t.jsx(m.Item,{name:"status",label:"状态",rules:[{required:!0}],children:t.jsx(N,{options:[{label:"启用",value:1},{label:"停止",value:2}]})})]})})]})},ne=o.memo(X);export{ne as default};
