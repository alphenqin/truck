import{r as n,h6 as _e,j as e,Y as G,h7 as Ae,V as U,h8 as Z,h9 as ee,gU as A,ha as ie,hb as te,hc as se,l as $,hd as ne,he as we,hf as ae,hg as Oe,hh as re,hi as Ne}from"./vendor-core-BL9Phd6R.js";import{e as Le,c as Fe,u as le,d as Ye,f as qe,h as Ke,i as He,j as ve,k as Be}from"./route-login-r9SQJoz-.js";import{u as ze}from"./useSearchForm-DGLxIQDe.js";import{a as d,o as Ve,p as Xe,q as $e,r as Ge}from"./route-layout-BrOgEPTf.js";import{g as Je}from"./index-C02sUyMg.js";import{A as f}from"./index-OYfbAcuj.js";import Qe from"./index-D80w2htZ.js";const We=()=>{const C=n.useRef(null),[p]=_e(),[o,w]=n.useState(10),[h,O]=n.useState(1),[N,L]=n.useState(0),[F,I]=n.useState(!1),[S,Y]=n.useState([]),[k,u]=n.useState([]),[D,T]=n.useState([]),[q,K]=n.useState([]),[H,v]=n.useState([]),[x,B]=n.useState([]),[a,g]=n.useState(),[m,E]=n.useState(!1),[R,c]=n.useState(!1),[z,j]=n.useState(!1),[V,M]=n.useState(!1),X=[{label:"角色ID",name:"id",component:e.jsx(U,{allowClear:!0})},{label:"角色名称",name:"roleName",component:e.jsx(U,{allowClear:!0})},{label:"角色描述",name:"description",component:e.jsx(U,{allowClear:!0})},{label:"创建时间",name:"startTime",component:e.jsx(Z,{allowClear:!0,style:{width:"200px"}})},{label:"更新时间",name:"endTime",component:e.jsx(Z,{allowClear:!0,style:{width:"200px"}})}],{SearchFormComponent:i}=ze({getDataRequestFn:t=>l(t),onNewRecordFn:()=>{E(!1),c(!0)},formItems:X,operateComponent:!!S.length&&e.jsx(f,{permission:d.permissionDicMap.EXPORT_ROLE,children:e.jsx(G,{type:"primary",icon:e.jsx(Ae,{}),onClick:()=>Le(S),children:"导出"})}),formName:"roleSearchUserForm"}),l=t=>{I(!0),Fe({limit:o,offset:(h-1)*o,...t}).then(s=>{K(s.data.list),L(s.data.total)}).finally(()=>{I(!1)})},oe=t=>{ie.confirm({title:"确认删除",content:"确定要删除该角色吗？",okText:"确定",cancelText:"取消",onOk:()=>{Be(t).then(()=>l())}})},ce=async t=>{g(t),E(!0),c(!0)},de=()=>{p.validateFields().then(t=>{m?le({...a,...t}).then(()=>{c(!1),l()}):Ye(t).then(()=>{c(!1),l()})})},[ue,me]=n.useState([]),fe=async t=>{const s=await ve(),r=await Je(),_=Ve(s.data),Me=Xe(r.data);me($e(r.data)),B(Me),v(_);const be=Ge(s.data);u(t.pageID?.filter(Pe=>be.includes(Pe))||[]),T(t.interfaceID||[]),g(t),j(!0)},[pe,he]=n.useState(!1),xe=(t,s)=>{he(!0),u([...t,...s.halfCheckedKeys])},ge=t=>{T(t)},Re=()=>{le({...a,pageID:pe?k:a?.pageID,interfaceID:D.filter(t=>!ue.includes(t))}).then(()=>{j(!1),l()})},[je,ye]=n.useState([]),[Ue,Ce]=n.useState(0),[y,J]=n.useState(10),[b,Q]=n.useState(1),Ie=async t=>{g(t),Q(1),J(10),await P(t,1,10),M(!0)},P=async(t,s,r)=>{const _=await Ke({roleID:t.id,limit:r,offset:(s-1)*r});ye(_.data.list),Ce(_.data.total)},W=async t=>{a?.id&&(await He({userID:t.id,roleID:a.id}),await P(a,b,y),C?.current?.getPageData())},Se=async(t,s)=>{a?.id&&(Q(t),J(s),await P(a,t,s))},ke=async t=>{await qe({userID:t.id,roleID:a.id}),await P(a,b,y)},De=[{title:"序号",align:"center",render:(t,s,r)=>(b-1)*y+r+1},{title:"账号",dataIndex:"account",key:"account"},{title:"昵称",dataIndex:"nickname",key:"nickname"},{title:"操作",key:"action",align:"center",render:(t,s)=>e.jsx("div",{className:"gap-2 flex text-red-500 items-center cursor-pointer justify-center",children:e.jsx(f,{permission:d.permissionDicMap.UNBIND_USER,children:e.jsx("span",{onClick:()=>W(s),children:"移除"})})})}],Te=[{title:"序号",align:"center",render:(t,s,r)=>(b-1)*y+r+1},{title:"账号",dataIndex:"account",key:"account"},{title:"昵称",dataIndex:"nickname",key:"nickname"},{title:"角色",dataIndex:"isAdmin",key:"isAdmin",align:"center",render:(t,{isAdmin:s})=>e.jsx(ee,{color:s?"gold":"green",children:s?"系统账号":"普通账号"})},{title:"状态",dataIndex:"status",key:"status",align:"center",render:(t,{status:s})=>e.jsx(ee,{color:s?"green":"red",className:"cursor-pointer",children:s==="1"?"启用":"禁用"})},{title:"创建时间",dataIndex:"createTime",key:"createTime",align:"center",render:(t,{createTime:s})=>e.jsx("span",{className:"text-[12px]",children:A(s).format("YYYY-MM-DD HH:mm:ss")})},{title:"更新时间",dataIndex:"updateTime",key:"updateTime",align:"center",render:(t,{updateTime:s})=>e.jsx("span",{className:"text-[12px]",children:A(s).format("YYYY-MM-DD HH:mm:ss")})},{title:"操作",key:"action",align:"center",render:(t,s)=>e.jsx("div",{className:"gap-2 flex text-[#48ade9] items-center cursor-pointer justify-center",children:e.jsx("span",{onClick:()=>W(s),children:"新增"})})}],Ee=[{title:"序号",align:"center",render:(t,s,r)=>(h-1)*o+r+1},{title:"角色名称",dataIndex:"roleName",key:"roleName"},{title:"角色描述",dataIndex:"description",key:"description"},{title:"创建时间",dataIndex:"createTime",key:"createTime",align:"center",render:(t,{createTime:s})=>e.jsx("span",{className:"text-sm",children:A(s).format("YYYY-MM-DD HH:mm:ss")})},{title:"更新时间",dataIndex:"updateTime",key:"updateTime",align:"center",render:(t,{updateTime:s})=>e.jsx("span",{className:"text-sm",children:A(s).format("YYYY-MM-DD HH:mm:ss")})},{title:"操作",key:"action",align:"center",render:(t,s)=>e.jsxs("div",{className:"gap-2 flex text-[#5bb4ef] items-center cursor-pointer justify-center",children:[e.jsx(f,{permission:[d.permissionDicMap.UPDATE_ROLE],children:e.jsx("span",{onClick:()=>fe(s),children:"权限编辑"})}),e.jsx(f,{permission:[d.permissionDicMap.UPDATE_ROLE],children:e.jsx("span",{onClick:()=>Ie(s),children:"授权用户"})}),e.jsx(f,{permission:d.permissionDicMap.UPDATE_ROLE,children:e.jsx("span",{onClick:()=>ce(s),children:"编辑"})}),e.jsx(f,{permission:d.permissionDicMap.DELETE_ROLE,children:e.jsx("span",{className:"text-red-500",onClick:()=>oe(s.id),children:"删除"})})]})}];return n.useEffect(()=>{R&&m&&p.setFieldsValue(a)},[R]),n.useEffect(()=>{l()},[o,h]),{userPageRef:C,limit:o,roleUnderUserLimit:y,total:N,roleUnderUserListTotal:Ue,roleColumns:Ee,userColumns:De,unSelectedUserColumns:Te,roles:q,SearchFormComponent:i,roleMenusSelected:k,roleInterfaceSelected:D,loading:F,editRoleModalOpen:R,isEdit:m,formRef:p,menus:H,currentEditRole:a,editRolePermissionOpen:z,editRoleUnderUserOpen:V,allInterface:x,roleUnderUsersList:je,addRoleUnderUserAction:ke,onPageTreeCheck:xe,onInterfaceTreeCheck:ge,onFinish:de,setEditRoleModalOpen:c,setSelected:Y,setPage:O,setLimit:w,roleUnderUserPageChange:Se,setEditRolePermissionOpen:j,setEditRoleUnderUserOpen:M,editPermissionConfirm:Re}},Ze=()=>{const{userPageRef:C,roles:p,roleColumns:o,userColumns:w,menus:h,SearchFormComponent:O,total:N,roleUnderUserListTotal:L,limit:F,roleUnderUserLimit:I,loading:S,isEdit:Y,formRef:k,roleInterfaceSelected:u,currentEditRole:D,editRoleModalOpen:T,editRolePermissionOpen:q,editRoleUnderUserOpen:K,onPageTreeCheck:H,allInterface:v,roleMenusSelected:x,onInterfaceTreeCheck:B,roleUnderUsersList:a,addRoleUnderUserAction:g,setEditRolePermissionOpen:m,setEditRoleUnderUserOpen:E,setPage:R,setLimit:c,roleUnderUserPageChange:z,setSelected:j,setEditRoleModalOpen:V,onFinish:M,editPermissionConfirm:X}=We();return e.jsxs(e.Fragment,{children:[O,e.jsx(te,{dataSource:p,rowSelection:{onChange:i=>{j(i)}},loading:S,columns:o,bordered:!0,pagination:!1,rowKey:"id"}),e.jsx(se,{total:N,className:"flex justify-end mt-2",pageSize:F,onChange:i=>R(i),showSizeChanger:!0,onShowSizeChange:(i,l)=>c(l)}),e.jsx(ie,{open:T,title:Y?"编辑":"新增",onOk:M,onCancel:()=>V(!1),children:e.jsxs($,{form:k,autoComplete:"off",labelAlign:"left",labelCol:{span:6},id:"editFormRef",children:[e.jsx($.Item,{name:"roleName",label:"角色名称",rules:[{required:!0}],children:e.jsx(U,{})}),e.jsx($.Item,{name:"description",label:"角色描述",rules:[{required:!0}],children:e.jsx(U,{})})]})}),e.jsx(ne,{title:"权限编辑",width:"40%",destroyOnClose:!0,onClose:()=>m(!1),open:q,extra:e.jsxs(Oe,{children:[e.jsx(G,{onClick:()=>m(!1),children:"取消"}),e.jsx(G,{type:"primary",onClick:X,children:"确认"})]}),children:e.jsx(we,{size:"small",items:[{label:"菜单权限",key:"1",children:e.jsx(e.Fragment,{children:e.jsx(ae,{treeData:h,checkable:!0,defaultExpandedKeys:x,defaultSelectedKeys:x,defaultCheckedKeys:x,multiple:!0,selectable:!1,onCheck:H})})},{label:"资源权限",key:"2",children:e.jsx(e.Fragment,{children:e.jsx(ae,{treeData:v,defaultExpandedKeys:u,defaultSelectedKeys:u,defaultCheckedKeys:u,multiple:!0,checkable:!0,selectable:!1,onCheck:B})})}]})}),e.jsx(ne,{open:K,title:"授权用户",width:"80%",destroyOnClose:!0,onClose:()=>E(!1),children:e.jsxs("div",{className:"flex gap-2 justify-between",children:[e.jsxs(re,{title:"已授权用户",style:{width:"50%"},children:[e.jsx(te,{dataSource:a,columns:w,pagination:!1,rowKey:"id",bordered:!0}),e.jsx(se,{total:L,className:"flex justify-end mt-2",pageSize:I,onChange:(i,l)=>z(i,l),showSizeChanger:!0})]}),e.jsx("div",{className:"my-auto",children:e.jsx(Ne,{})}),e.jsx(re,{title:"未授权用户",children:e.jsx(Qe,{ref:C,module:d.module.ROLE,context:D?.id,operation:g})})]})})]})},it=n.memo(Ze);export{it as default};
