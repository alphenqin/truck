import{h6 as K,r as s,j as e,Y as M,h7 as T,V as i,ha as R,hb as A,hc as z,l as x}from"./vendor-core-BL9Phd6R.js";import{A as m}from"./route-login-r9SQJoz-.js";import{u as D}from"./useSearchForm-DGLxIQDe.js";import"./route-layout-BrOgEPTf.js";const L=t=>m.post({url:"/base/notice/query",data:t}),_=t=>m.post({url:"/base/notice",data:t}),v=(t,o)=>m.patch({url:`/base/notice/update/${t}`,data:o}),B=t=>m.delete({url:"/base/notice/batch-delete",data:t}),H=t=>m.post({url:"/base/notice/export",data:{ids:t},responseType:"blob"}),Y=()=>{const[t]=K(),[o,N]=s.useState(10),[f,g]=s.useState(1),[j,b]=s.useState(0),[S,p]=s.useState(!1),[h,C]=s.useState([]),[y,F]=s.useState([]),[r,l]=s.useState(),[c,I]=s.useState(!1),[k,u]=s.useState(!1),q=[{label:"规则名称",name:"ruleName",component:e.jsx(i,{allowClear:!0})},{label:"规则键",name:"ruleKey",component:e.jsx(i,{allowClear:!0})},{label:"规则值",name:"ruleValue",component:e.jsx(i,{allowClear:!0})}],{SearchFormComponent:E}=D({getDataRequestFn:a=>d(a),onNewRecordFn:()=>{t.resetFields(),I(!1),u(!0)},formItems:q,operateComponent:!!h.length&&e.jsx(M,{type:"primary",icon:e.jsx(T,{}),onClick:()=>H(h.map(Number)),children:"导出"}),formName:"noticeSearchForm"}),d=a=>{p(!0),L({limit:o,offset:(f-1)*o,...a}).then(n=>{F(n.data.list),b(n.data.total)}).finally(()=>{p(!1)})},w=a=>{R.confirm({title:"确认删除",content:"确定要删除该规则吗？",okText:"确认",cancelText:"取消",onOk:()=>{B([a]).then(()=>d())}})},V=async a=>{l(a),I(!0),u(!0)},O=()=>{t.validateFields().then(a=>{if(c&&r){const n={...a,id:r.id};v(r.id,n).then(()=>{u(!1),d()})}else _(a).then(()=>{u(!1),d()})})},P=[{title:"ID",dataIndex:"id",key:"id"},{title:"规则名称",dataIndex:"ruleName",key:"ruleName"},{title:"规则键",dataIndex:"ruleKey",key:"ruleKey"},{title:"规则值",dataIndex:"ruleValue",key:"ruleValue"},{title:"操作",key:"action",align:"center",render:(a,n)=>e.jsxs("div",{className:"gap-2 flex text-[#5bb4ef] items-center cursor-pointer justify-center",children:[e.jsx("span",{onClick:()=>V(n),children:"编辑"}),e.jsx("span",{className:"text-red-500",onClick:()=>w(n.id),children:"删除"})]})}];return s.useEffect(()=>{k&&c&&t.setFieldsValue(r)},[k]),s.useEffect(()=>{d()},[o,f]),{list:y,noticeColumns:P,SearchFormComponent:E,total:j,limit:o,loading:S,isEdit:c,formRef:t,editNoticeModalOpen:k,setPage:g,setLimit:N,setSelected:C,setEditNoticeModalOpen:u,onFinish:O}},$=()=>{const{list:t,noticeColumns:o,SearchFormComponent:N,total:f,limit:g,loading:j,isEdit:b,formRef:S,editNoticeModalOpen:p,setPage:h,setLimit:C,setSelected:y,setEditNoticeModalOpen:F,onFinish:r}=Y();return e.jsxs(e.Fragment,{children:[N,e.jsx(A,{dataSource:t,rowSelection:{onChange:l=>{y(l)}},loading:j,columns:o,bordered:!0,pagination:!1,rowKey:"id"}),e.jsx(z,{total:f,className:"flex justify-end mt-2",pageSize:g,onChange:l=>h(l),showSizeChanger:!0,onShowSizeChange:(l,c)=>C(c)}),e.jsx(R,{open:p,title:b?"编辑":"新增",onOk:r,onCancel:()=>F(!1),children:e.jsxs(x,{form:S,autoComplete:"off",labelAlign:"left",id:"editFormRef",children:[e.jsx(x.Item,{name:"ruleName",label:"规则名称",rules:[{required:!0}],children:e.jsx(i,{})}),e.jsx(x.Item,{name:"ruleKey",label:"规则键",rules:[{required:!0}],children:e.jsx(i,{})}),e.jsx(x.Item,{name:"ruleValue",label:"规则值",rules:[{required:!0}],children:e.jsx(i,{})})]})})]})},W=s.memo($);export{W as default};
